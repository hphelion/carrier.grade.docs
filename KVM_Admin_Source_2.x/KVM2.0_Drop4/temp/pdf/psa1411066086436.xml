<?xml version="1.0" encoding="UTF-8"?><?workdir /C:\Drop3and4\Drop4\temp\pdf?><?workdir-uri file:/C:/Drop3and4/Drop4/temp/pdf/?><?path2project?><?path2project-uri ./?><task-wr xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" ditaarch:DITAArchVersion="1.2" domains="(topic task task-wr)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="psa1411066086436" xml:lang="en-us" class="- topic/topic task/task task-wr/task-wr ">
<!-- Modification History
        
-->
    <title ixia_locid="1" class="- topic/title ">Backing Up In-Use Cinder Volumes</title>
    <shortdesc ixia_locid="2" class="- topic/shortdesc ">You can back up Cinder volumes in the <i ixia_locid="3" class="+ topic/ph hi-d/i ">in-use</i>
        state.</shortdesc>
    <prolog class="- topic/prolog ">
        <author ixia_locid="4" class="- topic/author ">Pedro Sanchez</author>
    </prolog>
    <taskbody class="- topic/body task/taskbody ">
        <context id="context_N10022_N1001F_N10001" ixia_locid="5" class="- topic/section task/context ">
            <p ixia_locid="6" class="- topic/p ">A Cinder volume in the <i ixia_locid="68" class="+ topic/ph hi-d/i ">in-use</i> state is
                associated with an existing instance, either as the instance's disk image or as an
                attached storage resource. The instance may be either running or shut down. If the
                instance is running, then you must take a snapshot of the volume first, and then
                export it to the controller's file system. An effective and reliable strategy is to
                take snapshots of all <i ixia_locid="151" class="+ topic/ph hi-d/i ">in-use</i> volumes, regardless of whether
                the associated instances are running. If you prefer, you can use the <cmdname ixia_locid="149" class="+ topic/keyword sw-d/cmdname ">nova list</cmdname> command with the option <option ixia_locid="150" class="+ topic/keyword pr-d/option ">--all-tenants</option> to identify which instances are running,
                and then take snapshots selectively.</p>
            <codeblock ixia_locid="152" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="153" class="+ topic/ph sw-d/systemoutput ">~[keystone_admin]$ </systemoutput><userinput ixia_locid="154" class="+ topic/ph sw-d/userinput ">nova list --all-tenants</userinput>
<systemoutput ixia_locid="155" class="+ topic/ph sw-d/systemoutput ">
+--------+--------+-----------+--------+------------+-------------+----------+
| ID     | Name   | Tenant ID | Status | Task State | Power State | Networks |                                                                                                        |
+--------+--------+-----------+--------+------------+-------------+----------+
| 1f6... | t1-vm1 | 5e38b9... | ACTIVE | -          | Running     | tenan... |
| b92... | t1-vm2 | 5e38b9... | ACTIVE | -          | Running     | tenan... |
+--------+--------+-----------+--------+------------+-------------+----------+
</systemoutput></codeblock>
        </context>
        <steps class="- topic/ol task/steps ">
            <step id="step_N1003A_N10037_N10024_N10001" ixia_locid="131" class="- topic/li task/step " conref="psa1410446807133.xml#psa1410446807133/cli-admin-login">
                <cmd ixia_locid="132" class="- topic/ph task/cmd "/>
            </step>
            <step id="step_N1002E_N1002B_N10020_N10001" ixia_locid="70" class="- topic/li task/step ">
                <cmd ixia_locid="72" class="- topic/ph task/cmd ">Identify the volume you want to back up.</cmd>
                <substeps id="substeps_aqf_dsz_lp" class="- topic/ol task/substeps ">
                    <substep ixia_locid="13" class="- topic/li task/substep ">
                        <cmd ixia_locid="14" class="- topic/ph task/cmd ">List Cinder volumes from all tenants.</cmd>
                        <stepxmp ixia_locid="15" class="- topic/itemgroup task/stepxmp ">
                            <codeblock ixia_locid="16" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="133" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="18" class="+ topic/ph sw-d/userinput ">cinder list --all-tenants</userinput>
<systemoutput ixia_locid="134" class="+ topic/ph sw-d/systemoutput ">+--------------+-----------+--------------+... +----------+--------------+
|     ID       |   Status  | Display Name |... | Bootable | Attached to  |
+--------------+-----------+--------------+... +----------+--------------+
| 53ad007a-... |   in-use  |   volume-1   |... |  false   | c820df55-... |
| 578da734-... |   in-use  |              |... |  true    | c820df55-... |
| 593111d8-... | available |   volume-2   |... |  true    |              |
+--------------+-----------+--------------+... +----------+--------------+</systemoutput></codeblock>
                        </stepxmp>
                        <info ixia_locid="20" class="- topic/itemgroup task/info ">
                            <p ixia_locid="21" class="- topic/p ">Cinder volumes are listed also on the <wintitle ixia_locid="22" class="+ topic/keyword ui-d/wintitle ">Volumes</wintitle> page of the web
                                administration interface.</p>
                        </info>
                    </substep>
                    <substep ixia_locid="23" class="- topic/li task/substep ">
                        <cmd ixia_locid="24" class="- topic/ph task/cmd ">Identify the volume to back up.</cmd>
                        <info ixia_locid="25" class="- topic/itemgroup task/info ">
                            <p ixia_locid="26" class="- topic/p ">In the list above, two volumes are listed in the <i ixia_locid="73" class="+ topic/ph hi-d/i ">in-use</i> state:</p>
                            <ul id="ul_lfh_xv2_mp" class="- topic/ul ">
                                <li ixia_locid="74" class="- topic/li ">
                                    <p ixia_locid="75" class="- topic/p ">A volume named <nameliteral ixia_locid="27" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">volume-1</nameliteral> with ID
                                            <nameliteral ixia_locid="76" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">53ad007a-...</nameliteral>, attached to the
                                        running image  <nameliteral ixia_locid="77" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">c820df55-...</nameliteral>. The
                                        bootable flag is <i ixia_locid="78" class="+ topic/ph hi-d/i ">false</i>, which indicates that
                                        this is not a disk image.</p>
                                </li>
                                <li ixia_locid="79" class="- topic/li ">
                                    <p ixia_locid="80" class="- topic/p ">An unnamed volume with ID <nameliteral ixia_locid="81" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">578da734-...</nameliteral>, attached to
                                        the running image <nameliteral ixia_locid="82" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">c820df55-...</nameliteral>. The bootable flag is <i ixia_locid="83" class="+ topic/ph hi-d/i ">true</i>, which indicates that this
                                        is the instance's disk image. Unnamed volumes are
                                        dynamically created when the option <option ixia_locid="84" class="+ topic/keyword pr-d/option ">Instance Boot Source</option> in the <wintitle ixia_locid="85" class="+ topic/keyword ui-d/wintitle ">Launch Instance</wintitle> window of the
                                        web management interface is set to <i ixia_locid="86" class="+ topic/ph hi-d/i ">Boot from image (creates a new volume)</i> or <i ixia_locid="87" class="+ topic/ph hi-d/i ">Boot from volume snapshot (creates a new
                                            volume)</i>.</p>
                                </li>
                            </ul>
                            <p ixia_locid="88" class="- topic/p ">This example uses the unnamed disk image to
                                illustrate the backup procedure, but you must back up all <i ixia_locid="89" class="+ topic/ph hi-d/i ">in-use</i> volumes appropriately.</p>
                        </info>
                    </substep>
                </substeps>
            </step>
            <step id="step_N100E9_N10035_N10023_N10001" ixia_locid="90" class="- topic/li task/step ">
                <cmd ixia_locid="91" class="- topic/ph task/cmd ">Create a volume snapshot.</cmd>
                <stepxmp ixia_locid="92" class="- topic/itemgroup task/stepxmp ">
                    <codeblock ixia_locid="93" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="135" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="95" class="+ topic/ph sw-d/userinput ">cinder snapshot-create --force True --display-name test-vm-snapshot \
578da734-a416-47e7-97de-137aa10b90f8</userinput>
<systemoutput ixia_locid="136" class="+ topic/ph sw-d/systemoutput ">+---------------------+--------------------------------------+
|       Property      |                Value                 |
+---------------------+--------------------------------------+
|      created_at     |      2014-09-19T14:18:47.269583      |
| display_description |                 None                 |
|     display_name    |           test-vm-snapshot           |
|          id         | 53b5237c-5cd0-4939-ad6b-cf612e449216 |
|       metadata      |                  {}                  |
|         size        |                  1                   |
|        status       |               creating               |
|      volume_id      | 578da734-a416-47e7-97de-137aa10b90f8 |
+---------------------+--------------------------------------+</systemoutput></codeblock>
                </stepxmp>
                <info ixia_locid="97" class="- topic/itemgroup task/info ">
                    <p ixia_locid="98" class="- topic/p ">The status of the new snapshot is <i ixia_locid="99" class="+ topic/ph hi-d/i ">creating</i>, which means that it is in process. You must wait until it
                        becomes <i ixia_locid="129" class="+ topic/ph hi-d/i ">available</i> before proceeding.</p>
                    <p ixia_locid="100" class="- topic/p ">You can verify the status of all Cinder snapshots using the
                        following command:</p>
                    <codeblock ixia_locid="101" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="137" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="103" class="+ topic/ph sw-d/userinput ">cinder snapshot-list --all-tenants</userinput>
<systemoutput ixia_locid="138" class="+ topic/ph sw-d/systemoutput ">+--------------+--------------+-----------+------------------+------+
|    ID        | Volume ID    |   Status  |   Display Name   | Size |
+--------------+--------------+-----------+------------------+------+
| 53b5237c-... | 578da734-... | available | test-vm-snapshot |  1   |
+--------------+--------------+-----------+------------------+------+</systemoutput></codeblock>
                    <p ixia_locid="105" class="- topic/p ">In this example, the state of the snapshot
                            <nameliteral ixia_locid="106" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">test-vm-snapshot</nameliteral> is <i ixia_locid="107" class="+ topic/ph hi-d/i ">available</i>
                        already.</p>
                </info>
            </step>
            <step id="step_N1012C_N10035_N10023_N10001" ixia_locid="108" class="- topic/li task/step ">
                <cmd ixia_locid="109" class="- topic/ph task/cmd ">Export the snapshot to the controller's file system.</cmd>
                <stepxmp ixia_locid="110" class="- topic/itemgroup task/stepxmp ">
                    <codeblock ixia_locid="111" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="139" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="113" class="+ topic/ph sw-d/userinput ">cinder snapshot-export test-vm-snapshot</userinput>
<systemoutput ixia_locid="140" class="+ topic/ph sw-d/systemoutput ">+---------------------+--------------------------------------+
|       Property      |                Value                 |
+---------------------+--------------------------------------+
| display_description |                 None                 |
|          id         | 53b5237c-5cd0-4939-ad6b-cf612e449216 |
|        status       |              exporting               |
|      updated_at     |      2014-09-19T14:18:47.393220      |
|     volume_size     |                  1                   |
|     volume_type     |                 None                 |
+---------------------+--------------------------------------+</systemoutput></codeblock>
                </stepxmp>
                <info ixia_locid="115" class="- topic/itemgroup task/info ">
                    <p ixia_locid="116" class="- topic/p ">The status of the snapshot is <i ixia_locid="117" class="+ topic/ph hi-d/i ">exporting</i>, which means that it is not yet ready on the controller's
                        file system. As before, you can use the command <cmdname ixia_locid="130" class="+ topic/keyword sw-d/cmdname ">cinder snapshot-show </cmdname>
                        <varname ixia_locid="145" class="+ topic/keyword sw-d/varname ">UUID</varname> to verify the current status, and wait until the
                        snapshot's state is <i ixia_locid="119" class="+ topic/ph hi-d/i ">available</i> again.</p>
                </info>
                <stepresult ixia_locid="44" class="- topic/itemgroup task/stepresult ">
                    <p ixia_locid="45" class="- topic/p ">When the export operation completes, the backup file is
                        ready, as illustrated in the following example:</p>
                    <codeblock ixia_locid="46" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="141" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="48" class="+ topic/ph sw-d/userinput ">ls -lh /opt/backups</userinput>
<systemoutput ixia_locid="142" class="+ topic/ph sw-d/systemoutput ">total 258M
drwx------ 2 root root  16K Sep 10 17:42 lost+found
drwxr-xr-x 2 root root 4.0K Sep 19 14:30 temp
-rw-r--r-- 1 root root 258M Sep 19 14:30 volume-578da734-a416-47e7-97de-137aa10b90f8-20140919-142732.tgz</systemoutput></codeblock>
                    <p ixia_locid="120" class="- topic/p ">Note that the UUID used in the file name is the volume's and
                        not the snapshot's.</p>
                </stepresult>
            </step>
            <step id="step_N100E2_N10036_N10024_N10001" ixia_locid="50" class="- topic/li task/step ">
                <cmd ixia_locid="51" class="- topic/ph task/cmd ">Transfer the backup file to an external storage resource.</cmd>
                <info ixia_locid="52" class="- topic/itemgroup task/info ">
                    <p ixia_locid="53" class="- topic/p ">The following example uses the <cmdname ixia_locid="54" class="+ topic/keyword sw-d/cmdname ">scp</cmdname> command to transfer the backup file to a server named
                            <nameliteral ixia_locid="56" class="+ topic/ph hi-d/b wr-sw-d/nameliteral ">backups-server.wrs.com</nameliteral> in the
                        directory <filepath ixia_locid="55" class="+ topic/ph sw-d/filepath ">/backups/titanium</filepath>:</p>
                </info>
                <stepxmp ixia_locid="57" class="- topic/itemgroup task/stepxmp ">
                    <codeblock ixia_locid="58" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="143" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="60" class="+ topic/ph sw-d/userinput ">scp /opt/backups/volume-578da734-a416-47e7-97de-137aa10b90f8-20140919-142732.tgz \
admin@backups-server.wrs.com:/backups/titanium</userinput></codeblock>
                </stepxmp>
            </step>
            <step id="step_N101AE_N10035_N10023_N10001" ixia_locid="121" class="- topic/li task/step ">
                <cmd ixia_locid="122" class="- topic/ph task/cmd ">Delete the snapshot.</cmd>
                <stepxmp ixia_locid="123" class="- topic/itemgroup task/stepxmp ">
                    <codeblock ixia_locid="124" class="+ topic/pre pr-d/codeblock "><systemoutput ixia_locid="144" class="+ topic/ph sw-d/systemoutput ">~(keystone_admin)$ </systemoutput><userinput ixia_locid="126" class="+ topic/ph sw-d/userinput ">cinder snapshot-delete test-vm-snapshot</userinput></codeblock>
                </stepxmp>
                <info ixia_locid="127" class="- topic/itemgroup task/info ">
                    <p ixia_locid="146" class="- topic/p ">You can confirm that the snapshot is deleted using
                            <cmdname ixia_locid="147" class="+ topic/keyword sw-d/cmdname ">cinder snapshot-list --all-tenants</cmdname>.</p>
                    <p ixia_locid="148" class="- topic/p ">Once the snapshot has been exported, you should remove it
                        from the Cinder repositories to free up disk space.</p>
                </info>
            </step>
            <step id="step_N1010C_N10036_N10024_N10001" ixia_locid="61" class="- topic/li task/step ">
                <cmd importance="optional" ixia_locid="62" class="- topic/ph task/cmd ">Delete the backup file.</cmd>
                <info ixia_locid="63" class="- topic/itemgroup task/info ">
                    <p ixia_locid="64" class="- topic/p ">You may want to free up disk space on the controller to
                        accommodate additional Cinder volume backups.</p>
                </info>
            </step>
        </steps>
        <result id="result_N1011B_N10024_N10001" ixia_locid="65" class="- topic/section task/result ">
            <p ixia_locid="66" class="- topic/p ">The volume backup is complete. Repeat this procedure with all other
                Cinder volumes in the <i ixia_locid="67" class="+ topic/ph hi-d/i ">in-use</i> state in the system.</p>
        </result>
    </taskbody>
</task-wr>