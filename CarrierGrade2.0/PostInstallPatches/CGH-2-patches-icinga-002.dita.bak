<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581pdpi">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.0: Deploy the Cumulative Icinga
    Patch 037</title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 2.0"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Swarna Phaneendra"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 2.0"/>
    </metadata>
  </prolog>
  <body>
    <section id="fixes">
      <p>This patch is applicable for Denver, Tahoe, Memphis and Sacramento cloud topologies. It
        addresses the following issues:<ul id="ul_jxm_nkt_jv">
          <li>Will set up NRPE checks for basic services like disk,load, processes and users from
            all standard region nodes and reports in Icinga web.</li>
          <li> Openstack services of HOS controller nodes are monitored and reported in Icinga
            web.</li>
          <li> Icinga alerting and notification of all agents are reported in Icinga web.</li>
        </ul></p>
    </section>
    <section>
      <p>
        <note>
          <b>This is an optional patch and can be installed on need basis based on the below feature
            support.</b></note>
      </p>
    </section>
    <section>
      <title>Prerequisites</title>
      <ol id="ol_qrx_cnz_lw">
        <li>HCG cloud has already been deployed.</li>
        <li> HCG 2.0 GA (Build 36). </li>
      </ol>
    </section>
    <section conref="CGH-2-post-install-patching.dita#topic10581pdp/launch"/>
    <section><b>Start the patch download</b><p>To download the patch you need from the Software
        Updates and Licensing site, shown above: </p><ol id="ol_hst_1kg_rw">
        <li>Select the required patch file (e.g.<b
            conref="../Installation/prereqs/carrier-grade-install-download.dita#topic7148cgid/037"/>
          ) from the <b>Downloads</b> list and then click <b>Download</b>. <p><image
              href="../../media/carrier.grade.docs/CGH-2-software-licensing-patches-select-1.png"
              width="400" id="image_ist_1kg_rw"/></p></li>
        <li>Un-tar the downladed files (compressed patch files with extension <b>tar.gz</b> and
            <b>.tar</b>) until the <codeph>HCG-Cumulative-Icinga-Patch</codeph> and
            <codeph>Readme-post-deploy.txt</codeph> files are available. The readme with the patch
          download contains information on files changed by these patches.<note>The <b>Software
              Licensing</b> site lists and displays patch file names individually for all the three
            versions of HCG ( HCG_1.1, HCG_2.0 and HCG_2.1) under <b>Software Specification</b> and
              <b>Download filename</b>. Regardless of their version number, these files are
            referencing to the same files as extracted in the readme. </note></li>
        <li>Check if the MD5 checksum verification file is extracted along with the patch file.
              <p><image
              href="../../media/carrier.grade.docs/CGH-2-software-licensing-patches-select-2.png"
              width="400" id="image_jst_1kg_rw"/></p><note> For validating the integrity of the
            downloaded file, you can run the MD5 checksum verification on the downloaded patch file
            and verify if the fingerprint of the file matches the version available on the
            server.</note></li>
      </ol></section>
    <section>
      <title>Apply the patch</title>
      <ol id="ol_qbh_tpm_s5">
        <li>Log onto the lifecycle manager VM. <codeblock>ssh &lt;lifecycle manager_VM_IP></codeblock><p>where:
            lifecycle manager_VM_IP is the CLM IP of the lifecycle manager. Locate the IP address for the
            lifecycle manager in the <codeph>/root/infra-ansible-playbooks/group_vars/all</codeph>
            file under <codeph>hlm_clmstaticip</codeph> field.</p></li>
        <li>Copy the below mentioned patches on to hlm node under /root/ folder: <ul
            id="ul_ftp_ckb_mw">
            <li>0001-Config-as-single-patch-for-icinga-servies.patch</li>
            <li>0001-Node-Configuration-single-patch-for-all-services.patch</li>
          </ul></li>
        <li>Update the json files with "NRP-SVC" role in
            directory:<codeblock>/var/hlm/clouds/&lt;cloudname>/.hos/ [This directory contains the ansible roles for the applicable nodes across different topologies]</codeblock><note>Refer
            to the sample json file examples provided at the end of this file.</note></li>
        <li> Execute the following command from the hlm node:
          <codeblock>cd /root/kenobi-configuration-processor &amp;&amp; patch -p1 -b &lt; /root/0001-Config-as-single-patch-for-icinga-servies.patch</codeblock></li>
        <li>Execute the following command from the hlm node:
          <codeblock>cd /root/kenobi-node-configuration &amp;&amp; patch -p1 -b &lt; /root/0001-Node-Configuration-single-patch-for-all-services.patch
</codeblock></li>
        <li>Run <codeph>hlm_prepare-env.sh
          </codeph><codeblock>      cd ~/cg-hlm/hlm-build

     ./hlm_prepare-env.sh</codeblock></li>
        <li>Run <codeph>hlm
          generate</codeph><codeblock>hlm generate -c &lt;cloud name></codeblock></li>
        <li>Run only icinga roles:
            <codeblock>hlm deploy -c &lt;cloud name> -t "IC2-SVC IC2-WEB NRP-SVC" </codeblock><p>Where
            &lt;cloud name> is the name of your cloud.</p></li>
      </ol>
    </section>
    <section id="icinga-pass">
      <title>Sample json file updates across differnt topologies</title>
      <p>
        <codeblock>A. CG2.0 Denver
================

/var/hlm/clouds/&lt;cloud name>/.hos

File name: 
  ccp-1x3-ss.json

Example:
                {
                    "name": "IC2-WEB"
                },
                {
                    "name": "NRP-SVC"  #"NRP-SVC" role is added
                },
                {
                    "name": "rcp-libvirtmon-opensaf"
                },
                {
                    "name": "Finalize"
                }
B. HCG2.0 Tahoe
===============
json Files to be updated
-------------------------
  ccp-dcn-esx.json
  ccp-vrsg.json

Note: Please make sure "," is added at the end of each role as shown in the example.

File: ccp-vrsg.json
-------------------
Example1:

   "resource-node": {
        "type": "vrg",
        "services": [
            "FND-IPT",
            "ntp-client",
            "dns-client",
            "dcn-vrsg",
            "NRP-SVC"  # "NRP-SVC" role is added
           ]


File: ccp-dcn-esx.json
----------------------

Example:
========
"id": "1" section
                {
                    "name": "DCN-BRG"
                },
                {
                    "name": "DCN-RQ1"
                },
                {
                    "name": "DCN-VSC"
                },
                { 
                    "name": "NRP-SVC"    #  "NRP-SVC" role is added

                },                       

"id": "2" section
 Note: "NRP-SVC" role should be added before Finalize role


               {
                    "name": "IC2-SVC"
                },
                {
                    "name": "IC2-WEB"
                },
                {                             
                    "name": "NRP-SVC"    #"NRP-SVC" role should be added before Finalize role

                },          
                {
                    "name": "Finalize"
                },
                             
                {
                    "name": "DUM-BLS"
                }



C. HCG2.0 Memphis
=================
ccp-cpn.json, 
ccp-dcn-esx.json,
ccp-cpx.json,
ccp-vrsg.json 

Files: ccp-dcn-esx.json &amp; ccp-vrsg.json updates will be same as listed in the Tahoe section

Note: Please make sure "," is added at the end of each role as shown in the example.

File: ccp-cpn.json
------------------

  "resource-node": {
        "type": "cpn",
        "services": [
            "FND-IPT",
            "NTP-SVR",
            "NOV-CMP",
            "DCN-VRS",
            "CEI-CMP",
            "NRP-SVC",   #NRP-SVC" role is added
            "BVR-LOG"
        ]

File: ccp-cpx.json
------------------

"resource-node": {
        "type": "cpx",
        "services": [
            "FND-IPT",
            "NTP-SVR",
            "NOV-CPX",
            "CPX-CFG",
            "CEI-CMP",
            "NRP-SVC", #NRP-SVC" role is added
            "BVR-LOG"
            ]

D. HCG2.0 Sacramento
====================
ccp-compute-proxy.json
ccp-dcn-esx.json
ccp-vrsg.json

Files: ccp-dcn-esx.json &amp; ccp-vrsg.json updates will be same as listed in the Tahoe section

Note: Please make sure "," is added at the end of each role as shown in the example.

File: ccp-compute-proxy.json
----------------------------

resource-node": {
        "type": "cpx",
        "services": [
            "FND-IPT",
            "NTP-SVR",
            "NOV-CPX",
            "CPX-CFG",
            "CEI-CMP",
            "NRP-SVC", #NRP-SVC" role is added
            "BVR-LOG"
        ]


  
</codeblock>
      </p>
    </section>
    <section>
      <title>Next Step</title>
      <p><xref href="CGH-2-post-install-patching.dita#topic10581pdp/hos">Return to Post-Installation
          Patches</xref></p>
    </section>
  </body>
</topic>
