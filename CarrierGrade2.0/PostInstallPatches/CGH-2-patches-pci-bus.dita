<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581pdpp">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.0: Deploy the PCI Bus
    Patch</title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 1.1"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 1.1"/>
    </metadata>
  </prolog>
  <body>
    <p>This patch fixes the PCI Bus Assignment for VM Guest. This patch is applicable for all cloud
      topologies. </p>
    <p>If you did not deploy the KVM Region Custom Patch,
        <codeph>TS_HP_15_Custom_PATCH_0001_2.patch</codeph> during installation, perform the
      following steps. </p>
    <p>You should have downloaded the following patch files during the prerequisites. The patch is
      in a compressed file called <codeph>TS_HP_15_Custom_PATCH_0001_2.patch</codeph>. The README
      with the patch download contains information on files changed by these patches.</p>
    <p><b>Note:</b> You can use the Horizon UI to see if the patch has been deployed. Select the
        <codeph>regionkvm</codeph>, then click <b>Admin</b>, then <b>System</b>, and
        <b>Inventory</b>. Click the <b>Patches</b> table.</p>
    <p>This patch can be applied to KVM region in one of the following scenarios: <ul
        id="ul_vkz_w1t_q5">
        <li>after the cloud is deployed and KVM region is already up;</li>
        <li>before the KVM region has been deployed (before the <codeph>config_region</codeph>
          command has been executed)..</li>
      </ul></p>
    <section><title>Download the patch</title><p>If you have not downloaded the patch, launch the
          <xref href="https://helion.hpwsportal.com/catalog.html#/Home/Show" format="html"
          scope="external">Helion Distribution Network (HDN)</xref>. You must <xref
          href="https://idm.pod1.prod-core.hpwsportal.com/webid/" format="html" scope="external"
          >obtain a user account on HDN</xref> in order to download these files. </p>In a browser,
      navigate to <xref href="https://helion.hpwsportal.com/catalog.html#/Home/Show" format="html"
        scope="external">Helion Download Network(HDN)</xref>. <ol id="ol_skh_k5p_q5">
        <li>Click <b>Sign In</b> to log in using your account. </li>
        <li>After signing in, click the <b>Downloads</b> link in the menu on the left side of the
          page.</li>
        <li>Download the <b><b id="productShow_appName">Helion Carrier Grade 2.0 WR003
            Patch007</b></b> and the associated checksum and signature files.</li>
        <li>Verify the <xref
            href="../Installation/prereqs/carrier-grade-install-download.dita#topic7148cgid/verify"
            >downloaded signature</xref> and the <xref
            href="../Installation/prereqs/carrier-grade-install-download.dita#topic7148cgid/checksum"
            >downloaded checksums</xref>.</li>
        <li>Extract the compressed files until the
          <codeph>TS_HP_15_Custom_PATCH_0002.patch</codeph>, readme.txt and usecase.txt files are
          available.</li>
      </ol></section>
    <section><title>Deploy the patch on an existing system</title>If the cloud is deployed and KVM
      region is already up, perform the following steps to deploy this patch: <p><b>Patch the
          standby controller</b></p><p><b>Important:</b> Make sure the <xref
          href="CGH-2-patches-kvm-custom.dita#topic10581pdpk">KVM Region Custom Patch</xref> has
        been applied.</p><ol id="ol_erh_3xs_q5">
        <li>SSH into active controller in the KVM region. For example: <codeph>controller-0</codeph>
        </li>
        <li>Create a directory for the patch, if the directory does not
          exist:<codeblock>mkdir -p /tmp/patches</codeblock></li>
        <li>Copy the following patch file to the <codeph>/tmp/patches</codeph> directory:<ul>
            <li><codeph>TS_HP_15_Custom_PATCH_0002.patch</codeph><p>You should have downloaded this
                patch file in the Prerequisites. </p></li>
          </ul></li>
        <li>Execute the following commands:
          <codeblock>sudo sw-patch upload /tmp/patches/TS_HP_15_Custom_PATCH_0002.patch                </codeblock></li>
        <li>Execute the following command to verify that the patch is
          available:<codeblock>sudo sw-patch query</codeblock></li>
        <li>Execute the following command to verify the current state of all the
          hosts:<codeblock>sudo sw-patch query-hosts</codeblock></li>
        <li>Execute the following command to deploy the
          patch:<codeblock>sudo sw-patch apply TS_HP_15_Custom_PATCH_0002.patch</codeblock></li>
        <li>Execute the following command to set the environment variables in the Open Stack RC
          file:<codeblock>source /etc/nova/openrc</codeblock></li>
        <li>Execute the following command to patch and reboot the standby controller:
            <codeblock>system host-patch-reboot &lt;controller-#></codeblock><p>Wait until the
            rebooted controller node comes up after patching.</p><p>For example if
              <codeph>controller-1</codeph> is the standby
          controller:</p><codeblock>system host-patch-reboot controller-1</codeblock></li>
        <li>Execute the following command to switch the active controller from the specifed
          controller: <codeblock>system host-swact controller-# </codeblock><p>For example, switch
            the active controller from <codeph>controller-0</codeph> to
              <codeph>controller-1</codeph>:<codeblock>system host-swact controller-0</codeblock></p></li>
        <li>Exit the SSH session and SSH into the newly active controller.</li>
        <li>Execute the following command to set the environment variables in the Open Stack RC
          file:<codeblock>source /etc/nova/openrc</codeblock></li>
      </ol><p><b>Patch the new standby controller</b></p><p>Log onto the newly active controller and
        patch the standby controller.</p><ol id="ol_ovz_4s4_j5">
        <li>SSH into the newly active controller. For example: <codeph>controller-1</codeph>.</li>
        <li>Execute the following command: <codeblock>source /etc/nova/openrc</codeblock></li>
        <li>Execute the following command to patch and reboot the standby controller:
            <codeblock>system host-patch-reboot &lt;controller-#></codeblock><p>For example if
              <codeph>controller-0</codeph> is the standby
          controller:</p><codeblock>system host-patch-reboot controller-0</codeblock></li>
      </ol></section>
  </body>
</topic>
