<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic xml:lang="en-us" id="topic1107cgikd">
<title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.0: Step 6 - Deploying the KVM
    Region in a Denver Deployment</title>
<prolog>
  <metadata>
    <othermeta name="layout" content="default"/>
    <othermeta name="product-version" content="HP Helion OpenStack Carrier Grade 2.0"/>
    <othermeta name="role" content="Storage Administrator"/>
    <othermeta name="role" content="Storage Architect"/>
    <othermeta name="role" content="Michael B"/>
    <othermeta name="product-version1" content="HP Helion OpenStack Carrier Grade 2.0"/>
  </metadata>
</prolog>
<body>
    <section id="intro">
      <p>After the lifecycle manager is up and running and HP Helion OpenStack is installed, use the
        following steps to deploy the KVM region.</p>
      <p>The process for installing the KVM region involves the following tasks:<ul
          id="ul_fj4_mct_g5">
          <li><xref href="#topic1107cgikd/controller-0" format="dita">Step 1: Bring Up Controller-0
              in the KVM Region</xref></li>
          <li><xref href="#topic1107cgikd/custom-patch" format="dita">Step 2: Deploy the KVM Region
              Custom Patch</xref></li>
          <li><xref href="#topic1107cgikd/cloud" format="dita">Step 3: Configure the KVM region
              cloud</xref></li>
          <li><xref href="#topic1107cgikd/unlock" format="dita">Step 4: Configure and unlock the
              compute controllers</xref></li>
          <li><xref href="#topic1107cgikd/horizon-patch" format="dita">Step 5: Deploy the Horizon
              Patch</xref></li>
        </ul></p>
    </section>
    <section id="controller-0">
      <title>Step 1: Bring Up Controller-0 in the KVM Region</title>
      <ol id="ol_mf2_knq_35">
        <li>Make sure the server you will use for controller-0 is powered on and the other servers
          to be used in KVM region are shutdown.</li>
        <li>Launch the iLO interface for the server.</li>
        <li>Execute the following command to use the <codeph>bootimage_avs_only.iso</codeph> to boot
          the controller node.<codeblock>mount bootimage_avs_only.iso</codeblock></li>
        <li>Follow the install wizard. Select the Graphics mode for the controller only. Do not
          select <codeph>Controller+Compute</codeph>.<p>After the installation is complete, you will
            need to reboot the server. After the reboot:</p></li>
      </ol>
      <ol
        conref="../sacramento/carrier-grade-install-kvm-sacramento.dita#topic1107cgiks/controller-0-2"
        id="ol_xf4_rnq_35">
        <li/>
      </ol>
    </section>
    <section
      conref="../sacramento/carrier-grade-install-kvm-sacramento.dita#topic1107cgiks/kvm-custom-patch"
      id="custom-patch"/>
    <section
      conref="../sacramento/carrier-grade-install-kvm-sacramento.dita#topic1107cgiks/install-cloud"
      id="cloud"/>
    <section><title>Create the infrastructure and data interface</title><p>Execute the following
        commands from controller-0 to create the infrastructure and data intefaces:</p><ul
        id="ul_f1c_dk1_h5">
        <li><xref href="#topic10581cgidppncli/non" format="dita">For a Non-Bonded
          Environment</xref></li>
        <li><xref href="#topic10581cgidppncli/bond" format="dita">For a Bonded
          Environment</xref></li>
      </ul><p id="non">
        <b>For a Non-Bonded Environment</b></p><p>If you are using a non-bonded NIC environment,
        perform these steps to create the interfaces.:<ol id="ol_cjh_rys_gv">
          <li>From the KVM region controller, lock the compute-1
            node.<codeblock>system host-lock compute-1</codeblock></li>
          <li>Execute the following command to create an interface from compute-0 to the
            infrastructure
            network:<codeblock>system host-if-add -V &lt;vlan-id> -nt infra compute-0 &lt;name> vlan pxeboot0</codeblock>Where:
              <ul id="ul_edw_czs_gv">
              <li><codeph>vlan-id</codeph> is the VLAN ID;</li>
              <li><codeph>infra</codeph> is the type of network;</li>
              <li><codeph>compute-0</codeph> is the name of the compute node where the interface
                will be created;</li>
              <li><codeph>name</codeph> is the name of the interface;</li>
              <li><codeph>vlan</codeph> is the type of interface;</li>
              <li><codeph>pxeboot0</codeph> is the name of the interface to attach.</li>
            </ul> For
            example:<codeblock>system host-if-add -V 539 -nt infra compute-0 infra vlan pxeboot0</codeblock></li>
          <li>Execute the following command to create to create an interface from compute-0 to the
            data
            network:<codeblock>system host-if-add -nt data compute-0 &lt;name> vlan &lt;interface></codeblock>Where:
              <ul id="ul_h31_21t_gv">
              <li><codeph>data</codeph> is the data network;</li>
              <li><codeph>compute-0</codeph> is the name of the compute node where the interface
                will be created;</li>
              <li><codeph>name</codeph> is a descriptive name for the interface;</li>
              <li><codeph>vlan</codeph> is the type of interface;</li>
              <li><codeph>interface</codeph> is the name of the interface to attach.</li>
            </ul> For
            example:<codeblock>system host-if-add -nt data compute-0 data vlan eth2 pnet1 pnet2</codeblock></li>
          <li>Unlock the compute-0 node.<codeblock>system host-unlock compute-0</codeblock></li>
          <li>Lock the compute-1 node.<codeblock>system host-lock compute-1</codeblock></li>
          <li>Repeat commands above to create interfaces on compute-1 to the infrastructure network
            and the data network.
            <codeblock>system host-if-add -V &lt;vlan-id> -nt infra compute-1 &lt;name> vlan pxeboot0
system host-if-add -nt data compute-1 &lt;name> vlan &lt;interface></codeblock></li>
          <li>Unlock the compute-1 node.<codeblock>system host-unlock compute-1</codeblock></li>
        </ol></p><p id="bond">
        <b>For bonded NIC environments</b></p><p>If you are using a bonded NIC environment, perform
        these steps to create the interfaces.:</p>After the controller-1 and the compute nodes come
      up successfully after PXE boot, execute the following commands from controller-0 to add the
      required interface:<ol id="ol_zfq_5h1_tt">
        <li>Obtain the compute name or ID number:<codeblock>system host-list</codeblock></li>
        <li>Obtain the UUID of the MGMT interface:<codeblock>system host-if-list</codeblock></li>
        <li>Remove the PXE boot flag off the
          interface:<codeblock>system host-if-modify -nt "none" compute-1 pxeboot0</codeblock></li>
      </ol>Execute the following commands to create a bonded interface<ol id="ol_xyc_fww_dv">
        <li>From the KVM region controller, lock the compute-0
          node.<codeblock>system host-lock compute-0</codeblock></li>
        <li>Create a bonded interface for the control plane:
          <codeblock>system host-if-add -a 802.3ad -x layer2 -nt pxeboot compute-0 bond0 ae none eth0 eth1</codeblock></li>
        <li>Create a bonded interface to the infrastructure (infra) and management
          nwrot:<codeblock>system host-if-add -V &lt;vlan-id> -nt mgmt compute-0 &lt;name> vlan bond0</codeblock>Where:
            <ul id="ul_q4r_4jv_hv">
            <li><codeph>vlan-id</codeph> is the VLAN ID;</li>
            <li><codeph>mgmt</codeph> is the type of network;</li>
            <li><codeph>compute-0</codeph> is the name of the compute node where the interface will
              be created;</li>
            <li><codeph>name</codeph> is the name of the interface;</li>
            <li><codeph>vlan</codeph> is the type of interface;</li>
            <li><codeph>bond0</codeph> is the name of the bonded interface.</li>
          </ul></li>
        <li>Create a bonded interface to the infrastructure interface using the variables defined in
          the previous
          step:<codeblock>system host-if-add -V &lt;vlan-id> -nt infra compute-0 &lt;name> vlan bond0</codeblock>Where:
            <ul id="ul_qt5_yjv_hv">
            <li><codeph>infra</codeph> is the type of network;</li>
          </ul></li>
        <li>Create a bonded interface for the data plane:
          <codeblock>system host-if-add -a balanced -x layer2 -nt data compute-0 databond ae "provider-net-1" eth2 eth3 </codeblock>Where:
            <ul id="ul_c2b_1kv_hv">
            <li><codeph>data</codeph> is the type of network;</li>
          </ul></li>
        <li>Unlock the compute-0 node.<codeblock>system host-unlock compute-0</codeblock></li>
        <li>Lock the compute-1 node.<codeblock>system host-lock compute-1</codeblock></li>
        <li>Repeat the steps above on
          compute-1:<codeblock>system host-if-add -a 802.3ad -x layer2 -nt pxeboot compute-1 bond0 ae none eth0 eth1
system host-if-add -V 532 -nt mgmt compute-1 mgmt vlan bond0
system host-if-add -V 539 -nt infra compute-1 infra vlan bond0
system host-if-add -a balanced -x layer2 -nt data compute-1 databond ae "provider-net-1" eth2 eth3 </codeblock></li>
        <li>Unlock the compute-1 node.<codeblock>system host-unlock compute-1</codeblock></li>
      </ol></section>
    <section id="next-step">
      <title>Next Steps</title>
      <p><xref href="carrier-grade-install-post-denver.dita#topic1107cgidp">Post-Installation
          Tasks</xref>.</p>
    </section>
  </body>
</topic>
