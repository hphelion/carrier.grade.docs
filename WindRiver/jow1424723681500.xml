<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="jow1424723681500" xml:lang="en-us">
<!-- Modification History
        
-->
    <title ixia_locid="51">Specifying a Page Size for a VM </title>
    <shortdesc ixia_locid="52">You can request a specific memory page size for a VM by using a
        flavor with the required extra spec, or by defining an image with the required metadata
        property.</shortdesc>
    <prolog>
        <author ixia_locid="53">Jim Owens</author>
        <author ixia_locid="87">Pedro Sanchez</author>
    </prolog>
    <taskbody>
        <prereq id="prereq_N10022_N1001F_N10001" ixia_locid="61">
            <p ixia_locid="62">Host memory on compute nodes reserved for use by VMs is partitioned
                by default using only 2 MiB huge page blocks. These blocks are used by default as
                the backing mechanism for VM virtual memory allocation requests. See <ph ixia_locid="95" otherprops="printonly"><cite ixia_locid="96">Titanium Server System Administration: </cite></ph><cite ixia_locid="97"><ph ixia_locid="98"><xref href="jow1423087781001.xml" ixia_locid="99"/></ph></cite> for details on how to modify the
                memory partitioning scheme for a host.</p>
        </prereq>
        <context id="context_N1001F_N1001C_N10001" ixia_locid="54">
            <p ixia_locid="14"><note conref="jow1453048538675.xml#jow1453048538675/note_N10013_N10011_N10001" id="note_N1012A_N10027_N10024_N10001" ixia_locid="90"/>Memory requested by a
                guest is allocated as one or more pages of a specified size. Once allocated, the
                memory is unavailable for use by other guests until the instance is terminated. </p>
            <p ixia_locid="17">To add this extra spec to a flavor using the web administration
                interface, use the <uicontrol ixia_locid="78">Memory Page Size</uicontrol> selection
                in the <uicontrol ixia_locid="79">Create Flavor Extra Spec</uicontrol> drop-down
                menu. To access this menu, see <xref href="jow1429538642910.xml" ixia_locid="80"/>.</p>
            <p ixia_locid="18">You can also specify the extra spec from the CLI by setting the
                following parameter for a flavor:</p>
            <codeblock ixia_locid="20"><userinput ixia_locid="22">hw:mem_page_size=<varname ixia_locid="23">pagesize</varname></userinput></codeblock>
            <p ixia_locid="24">where <varname ixia_locid="25">pagesize</varname> is one of the
                following:</p>
            <dl>
                <dlentry ixia_locid="26">
                    <dt ixia_locid="27">small</dt>
                    <dd ixia_locid="28">
                        <p ixia_locid="29">Requests the smallest available size on the compute node,
                            which is always 4KiB of regular memory. </p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="30">
                    <dt ixia_locid="31">large</dt>
                    <dd ixia_locid="32">
                        <p ixia_locid="33">Requests the largest available huge page size, 1GiB or
                            2MiB.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="34">
                    <dt ixia_locid="35">any</dt>
                    <dd ixia_locid="36">
                        <p ixia_locid="37">Requests any available size, including small pages.
                            Titanium Server uses the largest available size, 1GiB, then 2MiB, and
                            then 4KiB.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="38">
                    <dt ixia_locid="39">2048</dt>
                    <dd ixia_locid="40">
                        <p ixia_locid="41">Requests a huge page of size 2 MiB. This is the default
                            value when the extra spec is not used.</p>
                    </dd>
                </dlentry>
                 <dlentry ixia_locid="42">
                    <dt ixia_locid="43">1048576</dt>
                    <dd ixia_locid="44">
                        <p ixia_locid="45">requests a huge page of size 1GiB.</p>
                    </dd>
                </dlentry> 
            </dl>
            <p ixia_locid="84">If any other value is supplied, it is ignored and the default value
                of <nameliteral ixia_locid="85">2048</nameliteral> is used.</p>
            <p ixia_locid="69">It is suggested that NFV applications use explicit huge page sizes to
                ensure predictable memory access at run time. Use of <nameliteral ixia_locid="88">large</nameliteral> and <nameliteral ixia_locid="89">any</nameliteral> sizes
                may cause VM migration issues when the available page size on the destination node
                is different. </p>
            <p ixia_locid="56">For example, to set a 1 GiB huge page size on a flavor that has
                already been created, use the following command:</p>
            <codeblock ixia_locid="57"><systemoutput ixia_locid="58">~(keystone)admin)$ </systemoutput><userinput ixia_locid="60">nova flavor-key <varname ixia_locid="81">flavor_name</varname> set hw:mem_page_size=1048576</userinput></codeblock>
            <p ixia_locid="15">You can also define an image with the required property by using the
                    <parmname ixia_locid="46">hw_mem_page_size</parmname> parameter to include image
                metadata, as in the following example:</p>
            <codeblock ixia_locid="21"><systemoutput ixia_locid="59">~(keystone)admin)$ </systemoutput><userinput ixia_locid="48">nova image-meta <varname ixia_locid="49">image</varname> set hw_mem_page_size=<varname ixia_locid="50">pagesize</varname></userinput></codeblock>
            <note id="note_N1011B_N10027_N10024_N10001" ixia_locid="91">
                <p ixia_locid="55"><draft-comment author="jowens" ixia_locid="92">CGTS-3747 reworded
                        and tagged as a Note</draft-comment>If you use image metadata to specify a
                    memory page size, the flavor extra specification must be set to <option ixia_locid="93">large</option> or <option ixia_locid="94">any</option>.</p>
            </note>
        </context>
    </taskbody>
</task-wr>