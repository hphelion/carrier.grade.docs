<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="jow1453828152714" xml:lang="en-us">
<!-- Modification History
        
-->
    <title ixia_locid="98">Ensuring Optimal vSwitch Processing of Physical Ports</title>
    <shortdesc ixia_locid="99">To ensure optimal vSwitch processing of physical ports, you can align
        the vSwitch NUMA node presence with physical-port NUMA node connectivity.</shortdesc>
    <prolog>
        <author ixia_locid="100">Jim Owens</author>
    </prolog>
    <taskbody>
        <context id="context_N1001F_N1001C_N10001" ixia_locid="101">
            <p ixia_locid="102"><draft-comment author="jowens" ixia_locid="89">US71812 new
                    topic</draft-comment>By default, each vSwitch core on the host services all
                physical ports on the host, including those connected to other NUMA nodes. In this
                configuration, traffic can cross the QPI bus between the NUMA nodes, presenting a
                bottleneck that can decrease overall performance.</p>
            <p ixia_locid="103">To address this, Titanium Server supports a split configuration, in
                which each AVS core services only the physical ports in the same NUMA node. This
                split configuration is automatically used on a compute host if and only if the
                following conditions are met:</p>
            <ul id="ul_x5b_wsj_55">
                <li ixia_locid="90">
                    <p ixia_locid="91">Every NUMA node with a vSwitch core has at least one data
                        interface.</p>
                </li>
                <li ixia_locid="92">
                    <p ixia_locid="93">Every NUMA node with a data interface has at least one
                        vSwitch core.</p>
                </li>
            </ul>
        </context>
        <steps>
            <step id="step_N10051_N1004E_N1001C_N10001" ixia_locid="104">
                <cmd ixia_locid="105">Identify the processors associated with data-interface ports
                    on the compute host.</cmd>
                <info ixia_locid="106">
                    <p ixia_locid="107"><draft-comment author="jowens" ixia_locid="135">US82332 interface
                            names</draft-comment>The <cmdname ixia_locid="132">system
                            host-port-list</cmdname> command shows the processor associated with
                        each port.</p>
                    <codeblock ixia_locid="109"><systemoutput ixia_locid="110">~(keystone_admin)$ </systemoutput><userinput ixia_locid="111">system host-port-list compute-0</userinput>
<systemoutput ixia_locid="112">+-----+--------+----------+--------------+--------+-----------+...
| uuid | name   | type     | pci address  | device | processor |...
+------+--------+----------+--------------+--------+-----------+...
| 4d...| enp0s3 | ethernet | 0000:00:03.0 | 0      | -1        |...
| 15...| enp0s8 | ethernet | 0000:00:08.0 | 0      | -1        |...
| ef...| eth0   | ethernet | 0000:00:09.0 | 0      | -1        |...
| ac...| eth1   | ethernet | 0000:00:0a.0 | 0      | -1        |...
+------+--------+----------+--------------+--------+-----------+...
...
</systemoutput></codeblock>
                </info>
            </step>
            <step id="step_N1009E_N1004E_N1001C_N10001" ixia_locid="121">
                <cmd ixia_locid="122">For each processor identified, ensure that at least one
                    vSwitch core is allocated.</cmd>
                <info ixia_locid="123">
                    <p ixia_locid="124">The system host-cpu-list command shows which cores are currently assigned as
                        vSwitch cores.</p>
                    <codeblock ixia_locid="125"><systemoutput ixia_locid="126">~(keystone_admin)$ </systemoutput><userinput ixia_locid="127">system host-cpu-list compute-0</userinput>
<systemoutput ixia_locid="128">
+------+----------+-----------+----------+--------+...+-------------------+
| uuid | log_core | processor | phy_core | thread |...| assigned_function |
+------+----------+-----------+----------+--------+...+-------------------+
| 81...| 0        | 0         | 0        | 0      |...| Platform          |
| 05...| 1        | 0         | 1        | 0      |...| Platform          |
| 90...| 2        | 0         | 2        | 0      |...| vSwitch           |
| 18...| 3        | 0         | 3        | 0      |...| vSwitch           |
| 39...| 4        | 0         | 4        | 0      |...| Shared            |
| 52...| 5        | 0         | 8        | 0      |...| VMs               |
| 0a...| 6        | 0         | 9        | 0      |...| VMs               |
| fb...| 7        | 0         | 10       | 0      |...| VMs               |
| 05...| 8        | 0         | 11       | 0      |...| VMs               |
| a0...| 9        | 0         | 12       | 0      |...| VMs               |
| cd...| 10       | 1         | 0        | 0      |...| VMs               |
| c9...| 11       | 1         | 1        | 0      |...| VMs               |
| 10...| 12       | 1         | 2        | 0      |...| VMs               |
| 6c...| 13       | 1         | 3        | 0      |...| VMs               |
| 26...| 14       | 1         | 4        | 0      |...| VMs               |
| af...| 15       | 1         | 8        | 0      |...| VMs               |
| 7c...| 16       | 1         | 9        | 0      |...| VMs               |
| b0...| 17       | 1         | 10       | 0      |...| VMs               |
| 9e...| 18       | 1         | 11       | 0      |...| VMs               |
| 62...| 19       | 1         | 12       | 0      |...| VMs               |
+------+----------+-----------+----------+--------+...+-------------------+
</systemoutput></codeblock>
                    <p ixia_locid="129">In this example, processor 0 has two vSwitch cores. However,
                        processor 1 does not have a vSwitch core. To ensure a split configuration on
                        this host, you must assign at least one core from processor 1 as a vSwitch
                        core.</p>
                    <p ixia_locid="130">To assign vSwitch cores, see <ph ixia_locid="136" otherprops="printonly"><cite ixia_locid="137">Titanium Server System Administration: </cite></ph><cite ixia_locid="138"><ph ixia_locid="139"><xref href="jow1404333768530.xml" ixia_locid="140"/></ph></cite>.</p>
                </info>
            </step>
            <step id="step_N100E8_N10052_N1001F_N10001" ixia_locid="133">
                <cmd ixia_locid="134">Ensure that no vSwitch cores are assigned for any processors
                    not associated with data-interface ports.</cmd>
            </step>
        </steps>
    </taskbody>
</task-wr>