<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="jow1429547742880" xml:lang="en-us">
<!-- Modification History
        
-->
    <title ixia_locid="345">Configuring vCPU Scheduling and Priority</title>
    <shortdesc ixia_locid="346">You can assign the Linux scheduler and priority for non-boot virtual
        CPUs using extra specifications.</shortdesc>
    <prolog>
        <author ixia_locid="347">Jim Owens</author>
        <author ixia_locid="366">Pedro Sanchez</author>
    </prolog>
    <taskbody>
        <context id="context_N1001F_N1001C_N10001" ixia_locid="348">
            <p ixia_locid="470"><draft-comment author="jowens" ixia_locid="471">CGTS-5158 topic updated to include
                    hw:cpu_realtime option</draft-comment>Two methods are supported. You cannot use
                both in the same flavor.</p>
            <dl>
                <dlentry ixia_locid="472">
                    <dt ixia_locid="473"><nameliteral ixia_locid="474">VCPU Scheduler Policy</nameliteral></dt>
                    <dd ixia_locid="475">
                        <p ixia_locid="476">You can use this method to configure the scheduling priority and
                            time-sharing algorithm for individual vCPUs. This option is available
                            from the web administration interface or the CLI.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="477">
                    <dt ixia_locid="478"><nameliteral ixia_locid="479">VCPU Real Time Policy</nameliteral></dt>
                    <dd ixia_locid="480">
                        <p ixia_locid="481"><draft-comment author="jowens" ixia_locid="482">The name "VCPU Real Time Policy" is one I
                                made up to provide a heading. Is there a better one I can
                                use?</draft-comment>You can use this method to assign real-time
                            privileges to one or more vCPUs. This option is available only from the
                            CLI.</p>
                    </dd>
                </dlentry>
            </dl>
            <p ixia_locid="483">Both methods require the <nameliteral ixia_locid="484">CPU Policy</nameliteral> to be set to
                    <option ixia_locid="485">Dedicated</option>. For more about the <nameliteral ixia_locid="486">CPU
                    Policy</nameliteral>, see <xref href="jow1448561585231.xml" ixia_locid="487"/>.</p>
            <p ixia_locid="488">Both methods lock guest RAM into memory. For improved
                    engineerability,<draft-comment author="jowens" ixia_locid="489">what word do I
                    want here to denote a completely known or fully predictable outcome or situation
                    as a software engineering goal or requirement?</draft-comment> the Titanium
                Server implementation does not lock lock the entire QEMU memory.</p>
            <note id="note_N10084_N10027_N10024_N10001" ixia_locid="490">
                <p ixia_locid="491">These extra specifications apply to non-boot virtual CPUs only.
                    For the boot CPU, the Linux scheduler and priority are fixed to normal
                    time-shared scheduling policy with a <i ixia_locid="183">nice</i> priority of
                    0.</p>
            </note>
        </context>
        <section id="section_N10093_N10024_N10001" ixia_locid="492">
            <title ixia_locid="493">VCPU Scheduler Policy</title>
            <p ixia_locid="468">This extra spec is shown only for flavors with more than one
                CPU.</p>
            <p ixia_locid="137">For each additional virtual CPU, the available options are:</p>
            <dl>
                <dlentry ixia_locid="349">
                    <dt ixia_locid="350"><option ixia_locid="494">Default Policy</option></dt>
                    <dd ixia_locid="351">
                        <p ixia_locid="352">Assigns a normal time-shared scheduling policy with <i ixia_locid="141">nice</i> priority of 0.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="353">
                    <dt ixia_locid="354"><option ixia_locid="495">Real-Time FIFO</option></dt>
                    <dd ixia_locid="355">
                        <p ixia_locid="356">Assigns a real-time, first-in-first-out policy, with
                            priority in the range of 1‒99, specified in the associated <uicontrol ixia_locid="358">VCPU Priority</uicontrol> field.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="359">
                    <dt ixia_locid="360"><option ixia_locid="496">Real-Time Round Robin</option></dt>
                    <dd ixia_locid="361">
                        <p ixia_locid="362">Assigns a real-time, round-robin policy, with priority
                            of 1‒99, specified in the associated <uicontrol ixia_locid="364">VCPU
                                Priority</uicontrol> field.</p>
                    </dd>
                </dlentry>
            </dl>
            <note id="note_N10089_N10026_N10023_N10001" ixia_locid="367">
                <p ixia_locid="368">The scheduling policy and priority level set by this extra spec
                    become effective when the virtual CPU thread is scheduled to run on dedicated
                    cores. Virtual CPU threads pinned to run on shared-only CPUs always use the
                    default policy of time-shared scheduling with <i ixia_locid="369">nice</i>
                    priority of 0. See <xref href="jow1426625051841.xml" ixia_locid="370"/> for
                    details.</p>
            </note>
            <draft-comment author="rstone" ixia_locid="469">CGTS-2530 changes</draft-comment>
            <p ixia_locid="17">To add this extra spec to a flavor the flavor must first be
                configured with two or more VCPUs. Use the web administration interface to select
                    <uicontrol ixia_locid="314">VCPU Scheduler Policy</uicontrol> in the <uicontrol ixia_locid="316">Create Flavor Extra Spec</uicontrol> drop-down menu. To access
                this menu, see <xref href="jow1429538642910.xml" ixia_locid="318"/>.</p>
            <p ixia_locid="142">You can specify the scheduler policy and priority for non-boot
                virtual CPUs from the CLI using the <option ixia_locid="143">hw:wrs:vcpu:scheduler</option> parameter on the <cmdname ixia_locid="145">nova
                    flavor-key</cmdname> command. This parameter accepts a semicolon-separated list
                of <varname ixia_locid="146">scheduler:priority:vcpus</varname> values enclosed by
                quotes, as follows.</p>
            <dl>
                <dlentry ixia_locid="147">
                    <dt ixia_locid="148"><varname ixia_locid="149">scheduler</varname></dt>
                    <dd ixia_locid="150">
                        <p ixia_locid="151">The scheduler policy. One of <i ixia_locid="152">other</i>, <i ixia_locid="153">fifo</i>, or <i ixia_locid="154">rr</i> to indicate normal time-shared, FIFO, and Round Robin
                            policies respectively.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="155">
                    <dt ixia_locid="156"><varname ixia_locid="157">priority</varname></dt>
                    <dd ixia_locid="158">
                        <p ixia_locid="159">The real-time scheduler priority. A value between 1 and
                            99.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="160">
                    <dt ixia_locid="161"><varname ixia_locid="162">vcpus</varname></dt>
                    <dd ixia_locid="163">
                        <p ixia_locid="164">An optional list of virtual CPUs as a comma-separated
                            list (1,2,3), or a range specification (1-3). Virtual CPU number 0
                            refers to the boot virtual CPU and therefore cannot be used.</p>
                    </dd>
                </dlentry>
            </dl>
            <p ixia_locid="166">To set real-time schedulers and priorities on virtual CPU 1 (FIFO,
                50) and virtual CPU 2 (Round Robin, 80):</p>
            <codeblock ixia_locid="167"><systemoutput ixia_locid="497">~(keystone_admin)$ </systemoutput><userinput ixia_locid="169">nova flavor-key <varname ixia_locid="341">flavor_name</varname> set hw:wrs:vcpu:scheduler="fifo:50:1;rr:80:2"</userinput></codeblock>
            <p ixia_locid="170">To set real-time Round Robin schedulers for three virtual CPU (Round
                Robin, 80):</p>
            <codeblock ixia_locid="171"><systemoutput ixia_locid="201">~(keystone_admin)$ </systemoutput><userinput ixia_locid="173">nova flavor-key <varname ixia_locid="342">flavor_name</varname> set hw:wrs:vcpu:scheduler=rr:80:1-3</userinput></codeblock>
            <p ixia_locid="174">To set the FIFO scheduler with priority 50 on all virtual CPUs
                except virtual CPU 0:</p>
            <codeblock ixia_locid="175"><systemoutput ixia_locid="202">~(keystone_admin)$ </systemoutput><userinput ixia_locid="177">nova flavor-key <varname ixia_locid="343">flavor_name</varname> set hw:wrs:vcpu:scheduler=fifo:50</userinput></codeblock>
            <p ixia_locid="178">To reset all scheduler settings to default values (non real-time
                scheduler with priority 0):</p>
            <codeblock ixia_locid="222"><systemoutput ixia_locid="225">~(keystone_admin)$ </systemoutput><userinput ixia_locid="228">nova flavor-key <varname ixia_locid="344">flavor_name</varname> unset hw:wrs:vcpu:scheduler</userinput></codeblock>
        </section>
        <section id="section_N101F0_N10024_N10001" ixia_locid="498">
            <title ixia_locid="499">VCPU Real Time Policy</title>
            <p ixia_locid="500"><draft-comment author="jowens" ixia_locid="522">CGTS-5158
                    new</draft-comment>Titanium Server supports the OpenStack <nameliteral ixia_locid="501">hw:cpu_realtime</nameliteral> extra specification for assigning
                a real-time FIFO policy to selected vCPUs. For the OpenStack documentation, see
                    <xref format="html" href="https://specs.openstack.org/openstack/nova-specs/specs/mitaka/implemented/libvirt-real-time.html" ixia_locid="502" scope="external"/>. </p>
            <p ixia_locid="503">Unlike the OpenStack implemenation, the Titanium Server implementation locks only the
                guest RAM, not the entire QEMU process. This ensures that resource allocations can
                be fully managed by the system at all times.</p>
            <p ixia_locid="504">To enable this policy on a flavor, use the following command:</p>
            <codeblock ixia_locid="505"><systemoutput ixia_locid="506">~(keystone_admin)$ </systemoutput><userinput ixia_locid="507">nova flavor-key <varname ixia_locid="508">flavor_name</varname> set hw:cpu_realtime=yes</userinput></codeblock>
            <p ixia_locid="509">You must exclude at least one VCPU from the policy to provide for
                housekeeping processes. To exclude vCPUs 0 and 1 from the policy, use the following
                command:</p>
            <codeblock ixia_locid="516"><systemoutput ixia_locid="517">~(keystone_admin)$ </systemoutput><userinput ixia_locid="518">nova flavor-key <varname ixia_locid="519">flavor_name</varname> set hw:cpu_realtime_mask=^0-1</userinput></codeblock>
        </section>
    </taskbody>
</task-wr>