<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr domains="(topic task task-wr)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="psa1410446902796" xml:lang="en-us" xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/">
    <!-- Modification History
        
-->
    <title ixia_locid="1">Removing Reboot-Required Patches</title>
    <shortdesc ixia_locid="2"><draft-comment author="rstone" ixia_locid="108">US62817 changed wrs-patch -&gt;
            sw-patch</draft-comment>Patches in the <i ixia_locid="38">Applied</i> or <i ixia_locid="37">Partial-Apply</i> states can be removed if necessary, for example, when
        they trigger undesired or unplanned effects on the Titanium cluster.</shortdesc>
    <prolog>
        <author ixia_locid="3">Pedro Sanchez</author>
    </prolog>
    <taskbody>
        <context id="context_N1001D_N1001A_N10001" ixia_locid="4">
            <p ixia_locid="5">Rolling back patches is conceptually identical to installing patches.
                A roll-back operation can be commanded for a patch in either the <i ixia_locid="39">Applied</i> or the <i ixia_locid="40">Partial-Apply</i> states. As the patch is
                removed, it goes through the following state transitions:</p>
            <dl>
                <dlentry ixia_locid="9">
                    <dt ixia_locid="10"><i ixia_locid="41">Applied</i> or <i ixia_locid="42">Partial-Apply</i> to <i ixia_locid="43">Partial-Remove</i></dt>
                    <dd ixia_locid="13">
                        <p ixia_locid="16">A patch in the <i ixia_locid="17">Partial-Remove</i>
                            state indicates that it has been removed from zero or more, but not from
                            all, the applicable hosts.</p>
                        <p ixia_locid="14">Use the command <cmdname ixia_locid="15">sw-patch
                                remove</cmdname> to trigger this transition.</p>
                    </dd>
                </dlentry>
                <dlentry ixia_locid="18">
                    <dt ixia_locid="19"><i ixia_locid="44">Partial-Remove</i> to <i ixia_locid="21">Available</i></dt>
                    <dd ixia_locid="22">
                        <p ixia_locid="23">Use the command <cmdname ixia_locid="24">sudo sw-patch
                                host-install-async</cmdname>
                            <varname ixia_locid="110">hostname</varname> repeatedly targeting each time one of the
                            applicable hosts in the cluster. The transition to the <i ixia_locid="25">Available</i> state is complete when the patch is
                            removed from all target hosts. The patch remains in the patch storage
                            area as if it had just been uploaded.</p>
                    </dd>
                </dlentry>
            </dl>
            <p ixia_locid="46">The following example is basically a copy of the workflow used in
                    <xref href="psa1410446976545.xml" ixia_locid="47"/>, but this time removing
                instead of installing the patch. The steps are therefore presented in simplified
                form. Removing patches can be done using the Web Administration Interface, also, as
                discussed in <xref href="psa1420733173602.xml" ixia_locid="109"/>. </p>
        </context>
        <steps>
            <step id="step_N10029_N10026_N1001A_N10001" ixia_locid="6">
                <cmd ixia_locid="7">Log in as Keystone user <nameliteral ixia_locid="45">admin</nameliteral> to the active controller.</cmd>
            </step>
            <step id="step_N100B2_N1009F_N10027_N10001" ixia_locid="48">
                <cmd ixia_locid="49">Verify the state of the patch.</cmd>
                <stepxmp ixia_locid="32">
                    <codeblock ixia_locid="33"><systemoutput ixia_locid="101">~(keystone_admin)$ </systemoutput><userinput ixia_locid="35">sudo sw-patch query</userinput>
<systemoutput ixia_locid="102">ï»¿       Patch ID             Patch State
=========================   ===========
TITANIUM_15.12_PATCH_0001   Applied</systemoutput></codeblock>
                    <p ixia_locid="50">In this example the patch is listed in the <i ixia_locid="51">Applied</i> state, but it could
                        be in the <i ixia_locid="52">Partial-Apply</i> state as well.</p>
                </stepxmp>
            </step>
            <step id="step_N100DD_N1009F_N10027_N10001" ixia_locid="53">
                <cmd ixia_locid="54">Remove the patch.</cmd>
                <stepxmp ixia_locid="55">
                    <codeblock ixia_locid="56"><systemoutput ixia_locid="103">~(keystone_admin)$ </systemoutput><userinput ixia_locid="58">sudo sw-patch remove TITANIUM_15.12_PATCH_0001</userinput>
<systemoutput ixia_locid="104">TITANIUM_15.12_PATCH_0001 has been removed from the repo</systemoutput></codeblock>
                </stepxmp>
                <stepresult ixia_locid="60">
                    <p ixia_locid="61">The patch is now in the <i ixia_locid="62">Partial-Remove</i>
                        state, ready to be removed from the impacted hosts where it was already
                        installed.</p>
                </stepresult>
            </step>
            <step id="step_N10103_N1009F_N10027_N10001" ixia_locid="63">
                <cmd ixia_locid="64">Query the patching status of all hosts in the cluster.</cmd>
                <stepxmp ixia_locid="65">
                    <codeblock ixia_locid="66"><systemoutput ixia_locid="105">~(keystone_admin)$ </systemoutput><userinput ixia_locid="68">sudo sw-patch query-hosts</userinput>
<systemoutput ixia_locid="106">
  Hostname      IP Address    Patch Current  Reboot Required  Release  State
============  ==============  =============  ===============  =======  =====
compute-0     192.168.204.12       Yes             No          15.12   idle
controller-0  192.168.204.3        No              Yes         15.12   idle
controller-1  192.168.204.4        No              Yes         15.12   idle
</systemoutput></codeblock>
                    <p ixia_locid="70">In this example, the controllers have patches ready to be
                        removed, and therefore must be rebooted.</p>
                </stepxmp>
            </step>
            <step id="step_N10121_N1009F_N10027_N10001" ixia_locid="71">
                <cmd ixia_locid="72">Remove all pending-for-removal patches from <nameliteral ixia_locid="73">controller-0</nameliteral>.</cmd>
                <substeps id="substeps_kzv_x13_pp">
                    <substep ixia_locid="74">
                        <cmd ixia_locid="75">Swact controller services.</cmd>
                    </substep>
                    <substep ixia_locid="78">
                        <cmd ixia_locid="79">Run the patching sequence.</cmd>
                        <stepxmp ixia_locid="80">
                            <codeblock ixia_locid="81"><systemoutput ixia_locid="107">~(keystone_admin)$ </systemoutput><userinput ixia_locid="83">sudo sw-patch host-install-async <varname ixia_locid="111">controller-0</varname></userinput></codeblock>
                        </stepxmp>
                    </substep>
                </substeps>
            </step>
            <step id="step_N1017D_N1009F_N10027_N10001" ixia_locid="94">
                <cmd ixia_locid="95">Remove all pending patches from <nameliteral ixia_locid="96">controller-1</nameliteral>.</cmd>
            </step>
        </steps>
        <result id="result_N10186_N10027_N10001" ixia_locid="97">
            <p ixia_locid="98">The Titanium cluster is up to date now. All patches have been
                removed, and the patch TITANIUM_15.12_PATCH_0001 can be deleted from the patch
                storage area if necessary.</p>
            <p ixia_locid="99">It is important to note the role of the command <cmdname ixia_locid="100">sudo sw-patch host-install-async </cmdname>
                <varname ixia_locid="112">hostname</varname> as a tool that both installs and removes patches as
                necessary.</p>
        </result>
    </taskbody>
</task-wr>