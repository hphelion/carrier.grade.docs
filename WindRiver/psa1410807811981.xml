<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr domains="(topic task task-wr)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="psa1410807811981" xml:lang="en-us" xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/">
<!-- Modification History
        
-->
    <title ixia_locid="1">System Data Backup with Controller Storage</title>
    <shortdesc ixia_locid="2">A system data backup of a Titanium Server system with controller
        storage captures core system information needed to restore a fully operational Titanium
        Server cluster.</shortdesc>
    <prolog>
        <author ixia_locid="3">Pedro Sanchez</author>
    </prolog>
    <taskbody>
        <context id="context_N1001F_N1001C_N10001" ixia_locid="4">
            <p ixia_locid="5">System data backups include:</p>
            <ul id="ul_enh_3dl_lp">
                <li ixia_locid="6">
                    <p ixia_locid="7">platform configuration details</p>
                </li>
                <li ixia_locid="8">
                    <p ixia_locid="9">system databases</p>
                </li>
                <li ixia_locid="10">
                    <p ixia_locid="11">patching and package repositories</p>
                </li>
                <li ixia_locid="14">
                    <p ixia_locid="15">home directory for the <nameliteral ixia_locid="66">wrsroot</nameliteral> user and all LDAP user accounts. See <ph ixia_locid="182" otherprops="printonly"><cite ixia_locid="183">Titanium
                                Server System Administration:</cite>
                        </ph><cite ixia_locid="184"><ph ixia_locid="185"><xref href="ekn1460051057968.xml" ixia_locid="187"/></ph></cite> for additional
                        information.</p>
                </li>
            </ul>
            <p ixia_locid="16">System data backups do not include:</p>
            <ul id="ul_im2_b2y_lp">
                <li ixia_locid="17">
                    <p ixia_locid="18">Modifications manually made to the file systems, such as
                        configuration changes on the <filepath ixia_locid="19">/etc</filepath>
                        directory. After a restore operation has been completed, these modifications
                        have to be reapplied.</p>
                </li>
                <li ixia_locid="20">
                    <p ixia_locid="21">Home directories and passwords of local user accounts. They
                        must be backed up manually by the system administrator.</p>
                </li>
                <li ixia_locid="59">
                    <p ixia_locid="60">The <filepath ixia_locid="61">/root</filepath> directory. Use
                        the <nameliteral ixia_locid="62">wrsroot</nameliteral> account instead when
                        root access is needed.</p>
                </li>
            </ul>
        </context>
        <steps>
            <step id="step_N10081_N1007E_N1001C_N10001" ixia_locid="25">
                <cmd ixia_locid="26">Log in as user <nameliteral ixia_locid="27">wrsroot</nameliteral> to the active controller.</cmd>
                <info ixia_locid="63">
                    <p ixia_locid="64">You can log in directly on the console or remotely using
                            <nameliteral ixia_locid="65">ssh</nameliteral>.</p>
                </info>
            </step>
            <step id="step_N1008E_N1007E_N1001C_N10001" ixia_locid="28">
                <cmd ixia_locid="29">Execute the system backup.</cmd>
                <stepxmp ixia_locid="30">
                    <codeblock ixia_locid="67"><systemoutput ixia_locid="68">$ </systemoutput><userinput ixia_locid="69">sudo config_controller --backup titanium_backup_20140918</userinput>
<systemoutput ixia_locid="70">Performing backup (this will take several minutes):
Step 13 of 13 [#############################################] [100%]
System backup file created: /opt/backups/titanium_backup_20140918_system.tgz
Images backup file created: /opt/backups/titanium_backup_20140918_images.tgz

Backup complete</systemoutput></codeblock>
                </stepxmp>
                <info ixia_locid="34">
                    <p ixia_locid="35">In this example, the argument <term ixia_locid="36">titanium_backup_20140918</term> to the <option ixia_locid="37">--backup</option> option is an arbitrary identifier you want to use for
                        the backup.</p>
                </info>
                <stepresult ixia_locid="38">
                    <p ixia_locid="39">Upon successful execution of the command, the following two files are
                        available on the controller's file system:</p>
                    <ul id="ul_tx1_jyy_lp">
                        <li ixia_locid="40">
                            <p ixia_locid="41"><filepath ixia_locid="42">/opt/backups/titanium_backup_20140918_system.tgz</filepath></p>
                        </li>
                        <li ixia_locid="43">
                            <p ixia_locid="44"><filepath ixia_locid="45">/opt/backups/titanium_backup_20140918_images.tgz</filepath></p>
                        </li>
                    </ul>
                    <p ixia_locid="46">Together, these two files represent the entire system
                        data.</p>
                </stepresult>
            </step>
            <step id="step_N10120_N1009B_N1001F_N10001" ixia_locid="71">
                <cmd ixia_locid="72"><draft-comment author="jowens" ixia_locid="73">CGTS-3757 added step</draft-comment>On a Ceph
                    system, export the image content.</cmd>
                <info ixia_locid="74">
                    <p ixia_locid="75">This step applies only to systems that use Ceph storage (systems with storage
                        nodes).</p>
                    <p ixia_locid="76">To perform this step, you must become the Keystone admin user.</p>
                </info>
                <substeps id="substeps_kz1_d2j_w5">
                    <substep ixia_locid="77">
                        <cmd ixia_locid="78">
                            <draft-comment author="jowens" ixia_locid="186">CGTS-5112 command output
                                updated</draft-comment>
                        </cmd>
                        <info ixia_locid="79">
                            <codeblock ixia_locid="80"><systemoutput ixia_locid="81">~(keystone_admin)$ </systemoutput><userinput ixia_locid="82">glance image-list</userinput>
<systemoutput ixia_locid="83">
+--------------------------------------+------------+
| ID                                   | Name       |
+--------------------------------------+------------+
| 3b0cbb67-f794-4115-86e2-82b2276acb9c | cust-guest |
| 63aa7396-0587-4ee0-9a26-56c212d583d0 | cirros     |
+--------------------------------------+------------+</systemoutput></codeblock>
                        </info>
                    </substep>
                    <substep ixia_locid="84">
                        <cmd ixia_locid="85">Switch to the <nameliteral ixia_locid="94">root</nameliteral> account,
                            and then export the content.</cmd>
                        <info ixia_locid="86">
                            <note id="note_N10171_N1016D_N10164_N10140_N10120_N1009B_N1001F_N10001" ixia_locid="93">
                                <p ixia_locid="91">You must be logged in as root to run the <cmdname ixia_locid="92">image-backup</cmdname> command. </p>
                            </note>
                            <codeblock ixia_locid="87"><systemoutput ixia_locid="95">$ </systemoutput><userinput ixia_locid="96">sudo su -</userinput>
<systemoutput ixia_locid="97">$ </systemoutput><userinput ixia_locid="98">image-backup export 63aa7396-0587-4ee0-9a26-56c212d583d0</userinput>
<systemoutput ixia_locid="90">Exporting image: 100% complete...done. 
Exporting image: 100% complete...done.
Creating backup archive...done
Backup archive /opt/backups/image_63aa7396-0587-4ee0-9a26-56c212d583d0.tgz created </systemoutput></codeblock>
                        </info>
                    </substep>
                </substeps>
            </step>
            <step id="step_N100D9_N1007E_N1001C_N10001" ixia_locid="47">
                <cmd ixia_locid="48">Transfer the backup files to an external storage resource.</cmd>
                <info ixia_locid="49">
                    <p ixia_locid="50">You can use a command such as <cmdname ixia_locid="51">scp</cmdname> to transfer the backup
                        files to a server reachable over the OAM network. You can also copy them to
                        a locally attached storage device, such as an external USB drive.</p>
                </info>
            </step>
            <step id="step_N100EE_N1007E_N1001C_N10001" importance="optional" ixia_locid="52">
                <cmd ixia_locid="53">Delete the backup files.</cmd>
                <info ixia_locid="54">
                    <p ixia_locid="55">You may want to free up disk space on the controller to accommodate upcoming
                        Cinder volume backups.</p>
                </info>
            </step>
        </steps>
        <result id="result_N100FD_N1001C_N10001" ixia_locid="56">
            <p ixia_locid="57">The system data backup is now complete. The backup files must be kept
                in a secured location, probably holding multiple copies of them for redundancy
                purposes.</p>
        </result>
    </taskbody>
</task-wr>