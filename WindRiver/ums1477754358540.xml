<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="ums1477754358540" xml:lang="en-us">
<!-- Modification History
        
-->
    <title ixia_locid="1">Monitoring and Tuning Cache Tiering</title>
    <shortdesc ixia_locid="2">To ensure optimal cache tiering performance, you must monitor the system regularly
        and adjust the cache pool configurations as needed.</shortdesc>
    <prolog>
        <author ixia_locid="3"/>
    </prolog>
    <taskbody>
        <context id="context_N1001E_N1001B_N10001" ixia_locid="4">
            <p ixia_locid="5">The Titanium Server implementation of cache tiering allows the feature to be enabled
                or disabled easily. You must adjust the initial configuration for your system
                requirements, and monitor and tune the system performance at regular intervals.</p>
            <p ixia_locid="6">For best results:</p>
            <ul id="ul_vjh_rcw_tx">
                <li ixia_locid="7">
                    <p ixia_locid="8">Monitor the pool usage statistics daily using the <cmdname ixia_locid="9">ceph df
                            detail</cmdname> command. For more information, consult the public Ceph
                        documentation.</p>
                </li>
                <li ixia_locid="10">
                    <p ixia_locid="11">Tune the pools individually after initial setup.</p>
                    <p ixia_locid="12">During initial setup, the available pools are configured
                        globally with default settings by the <cmdname ixia_locid="13">system
                            service-parameter</cmdname> command. You must adjust the settings for
                        each pool individually.</p>
                    <dl>
                        <dlentry ixia_locid="14">
                            <dt ixia_locid="15"><nameliteral ixia_locid="16">images-cache</nameliteral></dt>
                            <dd ixia_locid="17">
                                <p ixia_locid="18">the Glance image storage pool</p>
                            </dd>
                        </dlentry>
                        <dlentry ixia_locid="19">
                            <dt ixia_locid="20"><nameliteral ixia_locid="21">cinder-volumes-cache</nameliteral></dt>
                            <dd ixia_locid="22">
                                <p ixia_locid="23">the Cinder block storage pool</p>
                            </dd>
                        </dlentry>
                        <dlentry ixia_locid="24">
                            <dt ixia_locid="25"><nameliteral ixia_locid="26">ephemeral-cache</nameliteral></dt>
                            <dd ixia_locid="27">
                                <p ixia_locid="28">the Nova storage pool</p>
                            </dd>
                        </dlentry>
                        <dlentry ixia_locid="29">
                            <dt ixia_locid="30"><nameliteral ixia_locid="31">.rgw.buckets-cache</nameliteral></dt>
                            <dd ixia_locid="32">
                                <p ixia_locid="33">the Swift object storage pool</p>
                            </dd>
                        </dlentry>
                    </dl>
                </li>
            </ul>
            <p ixia_locid="34">For each pool, you must tune the following parameters:</p>
            <ul id="ul_bkd_qjw_tx">
                <li ixia_locid="37">
                    <p ixia_locid="38"><parmname ixia_locid="39">target_max_bytes</parmname></p>
                    <note id="note_N100B0_N100A7_N100A3_N1001E_N1001B_N10001" ixia_locid="40">
                        <p ixia_locid="41">This value is calculated when the cache is enable, based on the size of
                            the cache tier and the quotas for the corresponding backing tier pool.
                            It is not set (and cannot be set) globally using the <cmdname ixia_locid="42">system
                                service-parameter</cmdname> command.</p>
                    </note>
                </li>
                <li ixia_locid="43">
                    <p ixia_locid="44"><parmname ixia_locid="45">target_max_objects</parmname></p>
                    <p ixia_locid="46">You must set this value to ensure that deleted objects are
                        evicted from the caching tier and the backing tier. If this parameter is not
                        set, then the backing pool may to become full due to undeleted objects.</p>
                    <note id="note_N100D1_N100BE_N100A3_N1001E_N1001B_N10001" ixia_locid="48">
                        <p ixia_locid="49">This value is not set (and cannot be set) globally using the
                                <cmdname ixia_locid="50">system service-parameter</cmdname> command.</p>
                    </note>
                </li>
                <li ixia_locid="51">
                    <p ixia_locid="52"><parmname ixia_locid="53">cache_min_flush_age</parmname></p>
                </li>
                <li ixia_locid="54">
                    <p ixia_locid="55"><parmname ixia_locid="56">cache_min_evict_age</parmname></p>
                </li>
                <li ixia_locid="57">
                    <p ixia_locid="58"><parmname ixia_locid="59">cache_target_dirty_ratio</parmname></p>
                </li>
                <li ixia_locid="60">
                    <p ixia_locid="61"><parmname ixia_locid="62">cache_target_full_ratio</parmname></p>
                </li>
            </ul>
            <p ixia_locid="63">You can tune these parameters using the <cmdname ixia_locid="35">ceph
                    osd pool set</cmdname> and <cmdname ixia_locid="36">ceph osd pool get</cmdname>
                commands. For more information, consult the public Ceph documentation.</p>
        </context>
        <example ixia_locid="64">
            <p ixia_locid="65">The following example adjusts the target_max_bytes setting for the
                    <nameliteral ixia_locid="66">images-cache</nameliteral> pool as part of a cache purge:</p>
            <ul id="ul_qvq_thw_tx">
                <li ixia_locid="67">
                    <p ixia_locid="68">Get the current setting:</p>
                    <codeblock ixia_locid="69"><systemoutput ixia_locid="70">~(keystone_admin)$ </systemoutput><userinput ixia_locid="71">ceph osd pool get images-cache target_max_bytes</userinput>
<systemoutput ixia_locid="72">~(keystone_admin)$ target_max_bytes: 9312209408</systemoutput></codeblock>
                </li>
                <li ixia_locid="73">
                    <p ixia_locid="74">Set it (along with other parameters, not shown) to initiate a cache
                        purge:</p>
                    <codeblock ixia_locid="75"><systemoutput ixia_locid="76">~(keystone_admin)$ </systemoutput><userinput ixia_locid="77">ceph osd pool set images-cache target_max_bytes 0</userinput>
<systemoutput ixia_locid="78">~(keystone_admin)$ set pool 6 target_max_bytes to 0</systemoutput></codeblock>
                </li>
                <li ixia_locid="79">
                    <p ixia_locid="80">Restore the setting (along with others, not shown) to re-enable the
                        cache:</p>
                    <codeblock ixia_locid="81"><systemoutput ixia_locid="82">~(keystone_admin)$ </systemoutput><userinput ixia_locid="83">ceph osd pool set images-cache target_max_bytes 9312209408</userinput>
<systemoutput ixia_locid="84">~(keystone_admin)$ set pool 6 target_max_bytes to 9312209408</systemoutput></codeblock>
                </li>
            </ul>
        </example>
    </taskbody>
</task-wr>