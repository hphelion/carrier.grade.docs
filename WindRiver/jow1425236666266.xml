<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="jow1425236666266" xml:lang="en-us">
<!-- Modification History
        
-->
    <title ixia_locid="1">Configuring the NUMA Node Allocations for a VM</title>
    <shortdesc ixia_locid="2">You can use flavor extra specs or image properties to allocate virtual
        memory and vCPU resources to virtual NUMA nodes.</shortdesc>
    <prolog>
        <author ixia_locid="3">Jim Owens</author>
    </prolog>
    <taskbody>
        <steps id="steps_q4v_blj_gr">
            <step id="step_N10038_N10034_N1001F_N10001" ixia_locid="8">
                <cmd ixia_locid="9">Declare the number of NUMA nodes to create on the guest.</cmd>
                <info ixia_locid="10">
                    <p ixia_locid="11">The following extra specification sets the number of NUMA
                        nodes:</p>
                    <codeblock ixia_locid="12">hw:numa_nodes=<varname ixia_locid="13">n</varname></codeblock>
                    <p ixia_locid="14">where <varname ixia_locid="15">n</varname> is the number of
                        NUMA nodes to create (1 or more).</p>
                </info>
                <stepxmp ixia_locid="16">
                    <p ixia_locid="320">For example, given the flavor <nameliteral ixia_locid="18">numa.pinned.asym</nameliteral>, use the following command to create two
                        NUMA nodes.</p>
                    <codeblock ixia_locid="95"><systemoutput ixia_locid="97">~(keystone_admin)$ </systemoutput><userinput ixia_locid="99">nova flavor-key numa.pinned.asym set hw:numa_nodes=2</userinput></codeblock>
                </stepxmp>
                <info ixia_locid="101">
                    <p ixia_locid="102">To set an image property instead, you can use the following command:</p>
                    <codeblock ixia_locid="96"><systemoutput ixia_locid="98">~(keystone_admin)$ </systemoutput><userinput ixia_locid="100">nova image-meta <varname ixia_locid="103">image</varname> hw_numa_nodes=2</userinput></codeblock>
                </info>
            </step>
            <step id="step_N1006D_N10034_N1001F_N10001" importance="optional" ixia_locid="22">
                <cmd ixia_locid="23">For each virtual NUMA node, assign a list of CPUs.</cmd>
                <info ixia_locid="24">
                    <p ixia_locid="25">This step is optional. By default, available CPUs for the
                        flavor are distributed evenly across the available virtual NUMA nodes.</p>
                    <p ixia_locid="26">The following extra specification assigns CPUs to a virtual
                        NUMA node:</p>
                    <codeblock ixia_locid="27">hw:numa_cpus.<varname ixia_locid="28">vnode_id</varname>=<varname ixia_locid="29">cpu_list</varname></codeblock>
                    <p ixia_locid="30">where</p>
                    <parml>
                        <plentry ixia_locid="31">
                            <pt ixia_locid="32"><parmname ixia_locid="33">vnode_id</parmname></pt>
                            <pd ixia_locid="34">
                                <p ixia_locid="35">is the number used to identify the virtual NUMA
                                    node (0 for the first node, 1 for the second, and so on).</p>
                            </pd>
                        </plentry>
                        <plentry ixia_locid="36">
                            <pt ixia_locid="37"><parmname ixia_locid="38">cpu_list</parmname></pt>
                            <pd ixia_locid="39">
                                <p ixia_locid="40">is a comma-separated list of vCPUs to assign to the node. The
                                    vCPUs for the flavor are enumerated beginning with 0.</p>
                            </pd>
                        </plentry>
                    </parml>
                </info>
                <stepxmp ixia_locid="41">
                    <p ixia_locid="263">For example, given flavor <nameliteral ixia_locid="43">numa.pinned.asym</nameliteral>, use the following command to assign
                        vCPU 0 to the first virtual NUMA node, and vCPUs 1 and 2 to the second
                        virtual NUMA node:</p>
                    <codeblock ixia_locid="44"><systemoutput ixia_locid="45">~(keystone_admin)$ </systemoutput><userinput ixia_locid="46">nova flavor-key numa.pinned.asym set hw:numa_cpus.0=0 \
hw:numa_cpus.1=1,2</userinput></codeblock>
                </stepxmp>
            </step>
            <step id="step_N100CF_N10034_N1001F_N10001" importance="optional" ixia_locid="47">
                <cmd ixia_locid="48">For each virtual NUMA node, assign an amount of memory.</cmd>
                <info ixia_locid="49">
                    <p ixia_locid="50">This step is optional. By default, available memory for the
                        flavor is distributed evenly across the available virtual NUMA nodes.</p>
                    <p ixia_locid="51">The following extra specification assigns memory to a virtual
                        NUMA node:</p>
                    <codeblock ixia_locid="78">hw:numa_mem.<varname ixia_locid="80">vnode_id</varname>=<varname ixia_locid="54">ram_size</varname></codeblock>
                    <p ixia_locid="55">where</p>
                    <parml>
                        <plentry ixia_locid="56">
                            <pt ixia_locid="57"><parmname ixia_locid="58">vnode_id</parmname></pt>
                            <pd ixia_locid="59">
                                <p ixia_locid="60">is the number used to identify the virtual NUMA
                                    node (0 for the first node, 1 for the second, and so on).</p>
                            </pd>
                        </plentry>
                        <plentry ixia_locid="61">
                            <pt ixia_locid="62"><parmname ixia_locid="63">ram_size</parmname></pt>
                            <pd ixia_locid="64">
                                <p ixia_locid="65">is the amount of RAM in MB.</p>
                            </pd>
                        </plentry>
                    </parml>
                </info>
                <stepxmp ixia_locid="66">
                    <p ixia_locid="67">For example, given flavor <nameliteral ixia_locid="68">numa.pinned.asym</nameliteral>, use the following command to assign 512
                        MB of RAM to each of two virtual NUMA nodes:</p>
                    <codeblock ixia_locid="69"><systemoutput ixia_locid="70">~(keystone_admin)$ </systemoutput><userinput ixia_locid="71">nova flavor-key numa.pinned.asym set hw:numa_mem.0=512 \
hw:numa_mem.1=512</userinput></codeblock>
                </stepxmp>
            </step>
            <step id="step_N10181_N10044_N1001F_N10001" importance="optional" ixia_locid="82">
                <cmd ixia_locid="83">Specify whether memory for the flavor can be drawn from more
                    than one host NUMA node if necessary. </cmd>
                <info ixia_locid="84">
                    <p ixia_locid="90">This step is optional. By default, memory is allocated from the designated
                        host NUMA node only.</p>
                    <p ixia_locid="85">To control whether memory for the flavor can be drawn from more than one host
                        NUMA node, use the following extra specification:</p>
                    <codeblock ixia_locid="79">hw:numa_mempolicy=<varname ixia_locid="81">policy</varname></codeblock>
                    <p ixia_locid="86">where <parmname ixia_locid="87">policy</parmname> is either
                            <nameliteral ixia_locid="88">strict</nameliteral> (to use only memory
                        from the designated host NUMA node) or <nameliteral ixia_locid="89">preferred</nameliteral> (to permit memory from other host NUMA nodes to
                        be used if necessary).</p>
                </info>
            </step>
        </steps>
        <postreq id="postreq_N1012F_N1001F_N10001" ixia_locid="72">
            <p ixia_locid="73">To pin the virtual NUMA nodes to host NUMA nodes, see <xref href="jow1425236723556.xml" ixia_locid="74"/>.</p>
        </postreq>
    </taskbody>
</task-wr>