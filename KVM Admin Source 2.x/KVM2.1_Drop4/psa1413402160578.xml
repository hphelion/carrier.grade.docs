<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr domains="(topic task task-wr)                            (topic hi-d)                            (topic pr-d)                            (topic sw-d)                            (topic ui-d)                            (topic wr-sw-d)                            (topic xml-d)   " id="psa1413402160578" xml:lang="en-us" xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/">
<!-- Modification History
        
-->
    <title>PCI Passthrough Ethernet Interfaces</title>
    <shortdesc>A <term>passthrough</term> Ethernet interface is a physical PCI Ethernet NIC on a
        compute node to which a virtual machine is granted direct access. This minimizes packet
        processing delays but at the same time demands special operational
        considerations.</shortdesc>
    <prolog><author/>
        <author/>
        <author/>
    </prolog>
    <taskbody>
        <context id="context_N10023_N10020_N10001">
            <p>For all purposes, a PCI passthrough interface behaves as if it were
                physically attached to the virtual machine. Therefore any potential throughput
                limitations coming from the virtualized environment, such as the ones introduced by
                internal copying of data buffers, are eliminated. However, by bypassing the
                virtualized environment, the use of PCI passthrough Ethernet devices introduces
                several restrictions that must be taken into consideration. They include:</p>
            <ul id="ul_mjs_m52_tp">
                <li>
                    <p>no support for LAG, QoS, ACL, or host interface monitoring</p>
                </li>
                <li>
                    <p>no support for live migration</p>
                </li>
                <li>
                    <p>no access to the compute node's AVS switch</p>
                </li>
            </ul>
            <p>A passthrough interface bypasses the compute node's AVS switch
                completely, and is attached instead directly to the provider network's access
                switch. Therefore, proper routing of traffic to connect the passthrough interface to
                a particular tenant network depends entirely on the VLAN tagging options configured
                on both the passthrough interface and the access port on the switch.</p>
            <p>The access switch routes incoming traffic based on a VLAN ID, which ultimately
                determines the tenant network to which the traffic belongs. The VLAN ID is either
                explicit, as found in incoming tagged packets, or implicit, as defined by the access
                port's default VLAN ID when the incoming packets are untagged. In both cases the
                access switch must be configured to process the proper VLAN ID, which therefore has
                to be known in advance.</p>
            <p>To review the current PCI passthrough and SR-IOV device assignments
                for a given provider network, see <xref href="jow1439301559036.xml"/>.</p>
            <p>In the following example a new virtual machine is launched by user
                    <nameliteral>user1</nameliteral> on tenant <nameliteral>tenant1</nameliteral>, with a passthrough interface connected to
                the tenant network <nameliteral>net0</nameliteral> identified with
                VLAN ID 10.</p>
        </context>
        <prereq id="prereq_N10065_N10020_N10001">
            <note id="note_N10096_N10082_N10029_N10001">
                <p>To use PCI passthrough or SR-IOV interfaces, you must have Intel
                    VT-d features enabled in the BIOS.</p>
            </note>
            <p>The exercise assumes that the underlying provider network
                    <nameliteral>group0-data0</nameliteral> exists already, and that VLAN ID 10 is a
                valid segmentation ID assigned to <nameliteral>tenant1</nameliteral>.</p>
        </prereq>
        <steps>
            <step id="step_N10079_N10076_N10020_N10001">
                <cmd>Log in as the <nameliteral>admin</nameliteral> user to the web management
                    interface.</cmd>
            </step>
            <step id="step_N1009B_N10088_N10024_N10001">
                <cmd>Lock the compute node you want to configure.</cmd>
            </step>
            <step id="step_N10086_N10076_N10020_N10001">
                <cmd>Configure the Ethernet interface to be used as a PCI
                    passthrough interface.</cmd>
                <info>
                    <p>Select the <wintitle>System
                            Inventory</wintitle> window from the <uicontrol>Admin</uicontrol> panel, click the <uicontrol>Hosts</uicontrol> tab, click the name of the compute node where the PCI
                        interface is available, click the <uicontrol>Interfaces</uicontrol> tab, and finally click the <uicontrol>Edit Interface</uicontrol> button associated with the
                        interface you want to configure. Fill in the window as illustrated
                        below:</p>
                    <fig id="fig_hfk_cfh_rr">
                        <image href="psa1428772332800.image" id="image_whc_5kh_rr">
                            <alt>TiS Edit PCI Passthrough Interface</alt>
                        </image>
                    </fig>
                    <p>In this example, Ethernet interface <nameliteral>eth8</nameliteral> is assigned the network type <term>pci-passthrough</term>, and configured as connected to provider network
                            <nameliteral>group0-data0</nameliteral>. Click the
                            <uicontrol>Save</uicontrol> button to proceed.</p>
                    <p>The interface can also be configured from the CLI as
                        illustrated below:</p>
                    <codeblock><systemoutput>~(keystone_admin)$ </systemoutput><userinput>system host-if-modify \
-nt pci-passthrough -p group0-data0 compute-0 eth8</userinput></codeblock>
                </info>
            </step>
            <step id="step_N100E9_N10076_N10020_N10001">
                <cmd>Create the <nameliteral>net0</nameliteral>
                    tenant network</cmd>
                <info>
                    <p>Select the <wintitle>Networks</wintitle>
                        window from the <uicontrol>Admin</uicontrol> panel, click
                        the <uicontrol>Networks</uicontrol> tab, and then click the
                            <uicontrol>Create Network</uicontrol> button. Fill in
                        the <wintitle>Create Network</wintitle> window as
                        illustrated below. You must ensure that:</p>
                    <ul id="ul_pcn_vb4_tp">
                        <li>
                            <p>The <nameliteral>tenant1</nameliteral> tenant has access to the tenant network,
                                either assigning it as the owner, as in the illustration (using
                                    <uicontrol>Project</uicontrol>), or by enabling the shared
                                flag.</p>
                        </li>
                        <li>
                            <p>The segmentation ID is set to 10. </p>
                        </li>
                    </ul>
                    <fig id="fig_kwr_hd4_tp">
                        <image href="psa1413406273455.image" id="image_ofd_kd4_tp" placement="inline">
                            <alt>Creating a tenant network for use with PCI
                                passthrough devices</alt>
                        </image>
                    </fig>
                    <p>Click the <uicontrol>Create Network</uicontrol> button to proceed.</p>
                </info>
            </step>
            <step id="step_N10144_N10076_N10020_N10001">
                <cmd>Configure the access switch.</cmd>
                <info>
                    <p>Configure the physical port on the access switch used to
                        connect to Ethernet interface <nameliteral>eth8</nameliteral> as an access port with default VLAN ID of 10.
                        Traffic across the connection is therefore untagged, and effectively
                        integrated into the targeted tenant network.</p>
                    <p>You can also use a trunk port on the access switch so that it
                        handles tagged packets as well. However, this opens the possibility for
                        guest applications to join other tenant networks using tagged packets with
                        different VLAN IDs, which might compromise the security of the system. See
                            <xref href="jow1404333739778.xml"/> for other details regarding the
                        configuration of the access switch.</p>
                </info>
            </step>
            <step id="step_N101A0_N10088_N10024_N10001">
                <cmd>Unlock the compute node.</cmd>
            </step>
            <step id="step_N1015D_N10076_N10020_N10001">
                <cmd>Launch the virtual machine.</cmd>
                <substeps id="substeps_snp_klt_tp">
                    <substep>
                        <cmd>Log in as user <nameliteral>user1</nameliteral> to the web management
                            interface.</cmd>
                    </substep>
                    <substep>
                        <cmd>Configure the network interfaces for the new virtual machine.</cmd>
                        <info>
                            <p>Open the <wintitle>Launch
                                    Instance</wintitle> dialog by clicking the <uicontrol>Launch Interface</uicontrol> button on the
                                    <wintitle>Instances</wintitle> window. Configure
                                the necessary options for the new virtual machine. In particular,
                                click the <uicontrol>Networking</uicontrol> tab and
                                add a PCI passthrough interface on the tenant network <nameliteral>net0</nameliteral>, as illustrated below. Add
                                other network interfaces as needed.</p>
                            <fig id="fig_yxy_t1g_tp">
                                <image href="psa1413311389905.image" id="image_dbb_4dg_tp" placement="inline" width="5.5in">
                                    <alt>Assigning Passthrough PCI Ethernet
                                        Devices</alt>
                                </image>
                            </fig>
                            <p>Click the <uicontrol>Launch</uicontrol> button to proceed.</p>
                            <p>Passthrough interfaces can be attached from the CLI when booting a
                                new virtual machine, as illustrated below:</p>
                            <codeblock><systemoutput>~(keystone_admin)$ </systemoutput><userinput>nova boot \
--nic net-id=704e9f3b,vif-model=pci-passthrough \
--flavor small --image cgcs-guest my-new-vm</userinput></codeblock>
                            <note id="note_N10230_N101DF_N101D6_N101C3_N101B9_N1008C_N10028_N10001">
                                <p>By default, a VM that requires a PCI passthrough
                                    interface is instantiated only if a host NUMA node with a
                                    directly attached PCI interface is available. You can specify
                                    best-effort instantiation by using an extra specification. For
                                    more information, see <xref href="jow1436197980621.xml"/>.</p>
                            </note>
                        </info>
                    </substep>
                </substeps>
            </step>
        </steps>
        <result>
            <p>The new virtual machine instance is up now. It has a PCI passthrough
                connection to the <nameliteral>net0</nameliteral> tenant network
                identified with VLAN ID 10.</p>
        </result>
        <postreq conref="jow1439307476374.xml#jow1439307476374/postreq_N1023B_N10024_N10001" id="postreq_N10262_N10029_N10001"/>
    </taskbody>
</task-wr>