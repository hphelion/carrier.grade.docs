<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581pdpkvm5">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 1.1: Deploy the KVM Region Patch 5 </title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 1.1"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 1.1"/>
    </metadata>
  </prolog>
  <body>
    <section id="fixes">
      <p>This patch addresses a number of issues in the KVM region, including:<ul id="ul_jxm_nkt_jv">
          <li>Correcting an issue on virtual machines with vNIC (Mellanox CX3 Pro) configured for
            PCI-Passthrough that causes tthe spawning state to hang indefinitely;</li>
          <li>Correcting an issue with the Horizon UI where the <b>Overview</b> tab shows an
            incorrect instance count;</li>
          <li>Correcting an issue where remote a Compute (Nova) services client fails to connect
            when HTTPS is configured;</li>
          <li>Correcting an issue where DRBD volumes are Offline after a network change; </li>
          <li>Correcting an issue with the Orchestration (Heat) service where auto-scaling does not
            function when using HTTPS; </li>
          <li>Correcting an issue on virtual machines that causes auto-recovery to fail in a
            VRS-based cloud; </li>
          <li>Correcting an issue with the pre-check function of the Swact operation that forces a
            stand-by controller into a <codeph>go-standby</codeph> state;</li>
          <li>Correcting an issue where the Install Patch command in the Horizon UI causes that node
            to reset when locked in iLo.</li>
        </ul></p>
    </section>
    <section>
      <p>
        <note> You can use the Horizon UI to see if the patch has been deployed. Select the
            <codeph>regionkvm</codeph>, then click <b>Admin</b>, then <b>System</b>, and
            <b>Inventory</b>. Click the <b>Patches</b> table for the
            <codeph>TS_15.05_PATCH_0005.patch.new</codeph>. Or use the CLI on the active KVM
          controller: <codeph>sudo sw-patch query</codeph>.</note>
      </p>
    </section>
      <section><title>Prerequisites</title>You must install the following patches before installing
      this patch. You should have installed KVM Region patches 1 and 2 during deployment of the KVM
        Region:<ul id="ul_cqr_spt_jv">
        <li>KVM Region Patch 1 (<codeph>HCG2.0_WR002_Patch005</codeph>)</li>
        <li>KVM Region Patch 2 (<codeph>HCG2.0_WR003_Patch007</codeph>)</li>
        <li><xref href="CGH-2-patches-wr-3-017.dita#topic10581pdpkvm3">KVM Region Patch 3
              (<codeph>HCG_2.0 WR004 Patch017</codeph>)</xref></li>
        <li><xref href="CGH-2-patches-wr-4-019.dita#topic10581pdpkvm4">KVM Custom Patch 4
              (<codeph>HCG_2.0 WR005 Patch019</codeph>)</xref>
        </li>
      </ul><p><b>Note:</b> You can use the Horizon UI to see if the patches have been deployed.
        Select the <codeph>regionkvm</codeph>, then click <b>Admin</b>, then <b>System</b>, and
          <b>Inventory</b>. Click the <b>Patches</b> table. Or use the CLI on the active KVM
        controller: <codeph>sudo sw-patch query</codeph>.</p></section>
    <section conref="../Post-InstallPatches/CGH-2-post-install-patching.dita#topic10581pdp/launch"/>
    <section><b>Start the patch download</b><p>To download the patch you need from the Software
        Updates and Licensing site, shown above: </p><ol id="ol_vg2_5ds_rw">
        <li>Select the required patch file (e.g <b>HCG 1.1 TS 15.05 PATCH 0005</b> ) from the
            <b>Downloads</b> list and then click <b>Download</b>. <p><image
              href="../../media/carrier.grade.docs/CGH-install-download-patches-select-1.png"
              width="400" id="image_wdr_yxz_pw"/></p></li>
        <li>Un-tar the downladed files (compressed patch files with extension <b>tar.gz</b> and
            <b>.tar</b>) until the <codeph>TS_15.05_PATCH_0005.patch.new</codeph> and readme files
          are available.<note>The <b>Software Licensing</b> site lists and displays patch file names
            individually for all the three versions of HCG ( HCG_1.1, HCG_2.0 and HCG_2.1) under
              <b>Software Specification</b> and <b>Download filename</b>. Regardless of their
            version number, these files are referencing to the same files as extracted in the
            readme. </note></li>
        <li>Check if the MD5 checksum verification file is extracted along with the patch file.
              <p><image
              href="../../media/carrier.grade.docs/CGH-install-download-patches-select-2.png"
              width="400" id="image_jpr_hkw_rw"/></p><note> For validating the integrity of the
            downloaded file, you can run the MD5 checksum verification on the downloaded patch file
            and verify if the fingerprint of the file matches the version available on the
            server.</note></li>
      </ol></section>
    <bodydiv id="install">
      <section><title>Install the patch</title><p>If <codeph>TS_15.05_PATCH_0005.patch.new</codeph>
          is not installed, use the following steps to install the patch.</p><p>Extract the
          compressed files you downloaded until the <codeph>TS_15.05_PATCH_0005.patch.new</codeph>,
          readme.txt and usecase.txt files are available.</p><p><b>Patch the standby
          controller</b></p><ol id="ol_bcm_yg4_j5">
          <li>SSH into active controller in the KVM region. <p>For example:
                <codeph>controller-0</codeph>
            </p></li>
          <li>Create a directory for the patch:<codeblock>mkdir -p /tmp/patches</codeblock></li>
          <li>Copy the following patch file to the <codeph>/tmp/patches</codeph> directory:
              <!--per https://wiki.hpcloud.net/pages/viewpage.action?pageId=56143898--><ul
              id="ul_ald_spz_35">
              <li><codeph>TS_15.05_PATCH_0005.patch.new</codeph></li>
            </ul></li>
          <li>Execute the following commands to upload the patch to the database:
            <codeblock>sudo sw-patch upload /tmp/patches/TS_15.05_PATCH_0005.patch.new</codeblock></li>
          <li>Execute the following commands to check if the patch is available for
              installation:<codeblock>sudo sw-patch query</codeblock><p>For example:</p><p><image
                href="../../media/carrier.grade.docs/CGH-2-patch17-qry.ptch-avail.png" width="500"
                id="image_tft_ncg_x5"/></p></li>
          <li>Execute the following commands to apply the
            patch:<codeblock>sudo sw-patch apply TS_15.05_PATCH_0005.patch.new
source /etc/nova/openrc</codeblock></li>
          <li>Execute the following commands to check the current state of all the
            hosts:<codeblock>sudo sw-patch query-hosts</codeblock>Your host <b>Reboot Required</b>
            state will be <b>Yes</b>. For example:<p><image
                href="../../media/carrier.grade.docs/CGH-2-patch17-qry-host.png"
                id="image_j4z_gyf_x5" width="500"/></p></li>
          <li>Execute the following command to patch and reboot the standby controller:
              <codeblock>system host-patch-reboot &lt;controller-#></codeblock><p>For example if
                <codeph>controller-1</codeph> is the standby
              controller:</p><codeblock>system host-patch-reboot controller-1</codeblock><p>Wait
              until the standby controller comes up after patching. </p></li>
          <li>Execute the following command to switch the active controller from the specified
            controller: <codeblock>system host-swact controller-# </codeblock><p>For example, if the
              active controller is
              <codeph>controller-0</codeph>:<codeblock>system host-swact controller-0</codeblock></p><p>This
              command makes <codeph>controller-1</codeph> the active controller and makes
                <codeph>controller-0</codeph> the standby.</p></li>
          <li>Exit the SSH session. </li>
        </ol><b>Patch the new standby controller</b><p>Log onto the newly active controller and
          patch the standby controller.</p><ol id="ol_ovz_4s4_j5">
          <li>SSH into the newly active controller. <p>For example:
              <codeph>controller-1</codeph>.</p></li>
          <li>Execute the following command: <codeblock>source /etc/nova/openrc</codeblock></li>
          <li>Execute the following command to patch and reboot the standby controller:
              <codeblock>system host-patch-reboot &lt;controller-#></codeblock><p>For example if
                <codeph>controller-0</codeph> is the standby
            controller:</p><codeblock>system host-patch-reboot controller-0</codeblock></li>
        </ol><p><b>Patch the compute nodes</b></p><p>From the active controller, perform the
          following steps:</p><ol id="ol_z3h_xs4_j5">
          <li>Execute the following command to patch and reboot the <codeph>compute-0</codeph>:
            <codeblock>system host-patch-reboot compute-0</codeblock></li>
          <li>Execute the following command to patch and reboot <codeph>compute-1</codeph>:
            <codeblock>system host-patch-reboot compute-1</codeblock></li>
          <li>Apply the patch to any remaining compute nodes. You can use the <codeph>check sudo
              sw-patch query-hosts</codeph> command to verify that the patch is applied on all the
            hosts.</li>
        </ol></section>
    </bodydiv>
    <section>
      <title>Next Step</title>
      <p><xref href="CGH-2-post-install-patching.dita#topic10581pdp/kvm">Return to Post-Installation
          Patches</xref></p>
    </section>
    
      
  </body>
</topic>
