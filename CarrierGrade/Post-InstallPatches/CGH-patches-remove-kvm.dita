<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581pdpkvmrmv">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 1.1: Remove KVM Region Patches </title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 1.1"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 1.1"/>
    </metadata>
  </prolog>
  <body>
    <bodydiv>
      <section id="uninstall">During the deployment of the KVM region, you might have installed two
        patches: <ul id="ul_owz_kfg_sv">
          <li>TS_15.05_DESIGN_PATCH_HEAT.patch</li>
          <li>TS_15.05_DESIGN_PATCH_HORIZON.patch</li>
        </ul>Before installing <xref href="CGH-2-patches-wr-3-017.dita#topic10581pdpkvm3">KVM Region
          Patch 3 (<codeph>HCG_2.0 WR004 Patch017</codeph>)</xref>, you must uninstall these
          patches:<ol id="ol_ebr_ktv_4v">
          <li>SSH into active controller in the KVM region. <p>For example:
                <codeph>controller-0</codeph>
            </p></li>
          <li>Execute the following command to determine if the patch was applied:
            <codeblock>sudo sw-patch query</codeblock>If you have already applied the
            TS_HP_15_Custom_PATCH_0006.patch, you should see the patch state as
              <codeph>Applied</codeph></li>
          <li>Execute the following command to remove the
            patch:<codeblock>sudo sw-patch remove TS_15.05_DESIGN_PATCH_HEAT
sudo sw-patch remove TS_15.05_DESIGN_PATCH_HORIZON</codeblock>You
            will see the patches are removed from the repository. </li>
          <li>Execute the following command to view the status of the patch:
            <codeblock>sudo sw-patch query</codeblock>The patches will be in the
              <codeph>Partial-Remove</codeph> state. </li>
          <li>Execute the following command to view the patching status of all
            hosts:<codeblock>sudo sw-patch query-hosts</codeblock>The reboot state for the
            controllers and compute hosts will be <codeph>Yes</codeph>.</li>
          <li>Execute the following command to patch and reboot the standby KVM region controller
            <codeblock>system host-patch-reboot &lt;standby-controller></codeblock>Where
              <codeph>&lt;standby-controller></codeph> is the name/number of the standby controller.
            Wait until the standby controller node comes up.
              <p>Example:<codeblock>system host-patch-reboot controller-1</codeblock></p><p>This
              example assumes controller-1 is standby. </p></li>
          <li>Execute the following command to make the active controller standby:
              <codeblock>system host-swact &lt;active-controller></codeblock><p>Where
                <codeph>&lt;active-controller></codeph> is the name/number of the active
              controller.</p>Example: <codeblock>system host-swact controller-0</codeblock></li>
          <li>Execute the following command to patch and reboot the standby KVM region controller
            <codeblock>system host-patch-reboot &lt;standby-controller></codeblock>Where
              <codeph>&lt;standby-controller></codeph> is the name or number of the standby
            controller. Wait until the standby controller node comes up. <p> Example:
              <codeblock>system host-patch-reboot controller-0</codeblock></p><p>This example
              assumes controller-0 is stand-by.</p></li>
          <li>Execute the following command: <ol id="ol_a2s_zsw_4v">
              <li>Patch and reboot
                  compute-0.<codeblock>system host-patch-reboot compute-0</codeblock><note>Wait for
                  the compute node to get back to <codeph>unlocked and available</codeph> state.
                  Check from cli using <codeph>system host-list</codeph> command. Execute the
                  following command to see if the "Reboot Required" column for compute-0 node is
                    <codeph>No</codeph>.<codeblock>sudo sw-patch query-hosts</codeblock>If the
                    <b>Reboot Required</b> column is set to <b>No</b>, go to Step 10. <p> If the
                      <b>Reboot Required</b> column is set to <b>Yes</b>, follow Step
                b.</p></note></li>
              <li>If Reboot Required column is <codeph>Yes</codeph>: execute the following steps:<ul
                  id="ul_jxd_ryw_4v">
                  <li>Reboot the compute node:<codeblock>system host-reboot compute-0</codeblock>Use
                    the <codeph>system host-list</codeph> command to monitor the reboot status. Wait
                    for the compute node to return to <codeph>online</codeph>,
                      <codeph>locked</codeph> and <codeph>disabled</codeph>, state. </li>
                </ul><ul id="ul_wsj_dtw_4v">
                  <li>Execute the following command to see status of the <b>Reboot Required</b>
                    column for compute-0.<codeblock>sudo sw-patch query-hosts</codeblock><p>If the
                        <b>Reboot Required</b> is <codeph>No</codeph>, perform the task in the
                      following bullet.</p><p>If the <b>Reboot Required</b> is still
                        <codeph>Yes</codeph>, execute the <codeph>system host-reboot
                        compute-0</codeph> command again.</p></li>
                  <li>When the <b>Reboot Required</b> is <codeph>No</codeph>, use the <codeph>system
                      host-list</codeph> command to monitor the reboot. Wait for the compute node to
                    return to <codeph>online</codeph>, <codeph>locked</codeph> and
                      <codeph>disabled</codeph>, state. </li>
                  <li>Then execute: <codeblock>system host-unlock compute-0</codeblock>Wait for the
                    compute node to return to the <codeph>unlocked</codeph>,
                      <codeph>enabled</codeph> and <codeph>available</codeph> states.</li>
                </ul></li>
            </ol></li>
          <li>Repeat the previous step for each compute node. </li>
          <li>Execute the following command to verify that all nodes are unlocked and the
            TS_HP_15_Custom_PATCH_0006.patch is in <codeph>Available</codeph> state:
            <codeblock>sudo sw-patch query-hosts</codeblock></li>
          <li>Execute the following command to delete the TS_HP_15_Custom_PATCH_0006.patch
            <codeblock>sudo sw-patch delete TS_HP_15_Custom_PATCH_0006</codeblock>If the delete is
            successful, the <codeph>sudo sw-patch query</codeph> will not list the patch. </li>
        </ol></section>
    </bodydiv>
    <section>
      <title>Next Step</title>
      <p><xref href="CGH-2-post-install-patching.dita#topic10581pdp/kvm">Return to Post-Installation
          Patches</xref></p>
    </section>
    
      
  </body>
</topic>
