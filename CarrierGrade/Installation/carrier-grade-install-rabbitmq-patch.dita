<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic xml:lang="en-us" id="topic10581cgirp">
<title>HPE Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 1.1: Applying the Rabbit MQ Random
    Password Patch</title>
<prolog>
  <metadata>
    <othermeta name="layout" content="default"/>
    <othermeta name="product-version" content="HPE Helion Openstack Carreir Grade 1.1"/>
    <othermeta name="role" content="Storage Administrator"/>
    <othermeta name="role" content="Storage Architect"/>
    <othermeta name="role" content="Michael B"/>
    <othermeta name="product-version1" content="HPE Helion Openstack Carreir Grade 1.1"/>
  </metadata>
</prolog>
<body>
    <p><!--Based on https://wiki.hpcloud.net/display/HCG/.Helion+CG+1.1+GA+Patch+Instructions--></p>
    <section><p>After executing this patch, OpenStack services will use a string of random
        characters as the RabbitMQ password. By default the services will use <codeph>guest</codeph>
        as the password. You should have downloaded the patch files in the <xref
          href="carrier-grade-install-pb-prereqs-GA.dita#topic7148/getinstall"
        >Prerequisites</xref>.</p><p>The password is located in the
          <codeph>&lt;cloud-name&gt;/clouds/v0/001/stage/ansible/group_vars/&lt;tier-name&gt;</codeph>
        file
        at:</p><codeblock>FND_RMQ: 
vars:  
rmq_service_password:random
rmq_service_user: guest          </codeblock><p>The
        random password can be found in the <codeph>rmq_service_password</codeph>
          field.</p><p><b>Notes:</b></p><ul id="ul_ss3_c5j_dt">
        <li>The Ceilometer service will be set to always use the password
            <codeph>metering_secret</codeph>.</li>
        <li>The Nova and Neutron services will be set to use the password
            <codeph>metada_shared_secret</codeph>.</li>
      </ul><p>The services will communicate with RabbitMQ using the newly defined password.
      </p><b>Note:</b> You need the Ubuntu patch utility installed on the lifecycle manager host. If you do not
      have the utility installed, use the following
        command:<codeblock>apt-get install patch</codeblock><p>To apply the patch:</p><ol
        id="ol_dhy_1pj_dt">
          <li>Log into the lifecycle manager host.</li>
        <li>Copy the <codeph>random-password.tar.gz</codeph> to the
            <codeph>~/patch_cghelion1.1</codeph> directory.
          <codeblock>cp random-password.tar.gz ~/patch_cghelion1.1</codeblock></li>
        <li>Use the following command to extract the <codeph>random-password.tar.gz</codeph>:
          <codeblock>tar -zxvf random-password.tar.gz</codeblock></li>
      </ol></section>
      <section><title>Apply the patch to the configuration processor</title>
        <ol>
        <li>Change to the following directory:
          <codeblock>cd ~/kenobi-configuration-processor</codeblock></li>
        <li> Execute the following command to perform a dry-run of the patch to verify:
            <codeblock>patch -p1 --dry-run &lt; ~/patch_cghelion1.1/random-password-cp.patch </codeblock><p>The
            output appears similar to the
          following:</p><codeblock>checking file Data/Site/services/ceilometer/api.json
checking file Data/Site/services/cinder/cinder.json
checking file Data/Site/services/cinder/scheduler.json
checking file Data/Site/services/glance/api.json
checking file Data/Site/services/heat/api.json
checking file Data/Site/services/icinga/service.json
checking file Data/Site/services/keystone.json
checking file Data/Site/services/logstash.json
checking file Data/Site/services/neutron/api.json
checking file Data/Site/services/nova/api.json
checking file Data/Site/services/rabbitmq.json</codeblock></li>
        <li> Execute the following command to apply the
            patch:<codeblock>patch -p1 &lt; ~/patch_cghelion1.1/random-password-cp.patch</codeblock><p>The
            output appears similar to the
          following:</p><codeblock>patching file Data/Site/services/ceilometer/api.json 
patching file Data/Site/services/cinder/cinder.json 
patching file Data/Site/services/cinder/scheduler.json
patching file Data/Site/services/glance/api.json
patching file Data/Site/services/heat/api.json
patching file Data/Site/services/icinga/service.json
patching file Data/Site/services/keystone.json
patching file Data/Site/services/logstash.json
patching file Data/Site/services/neutron/api.json
patching file Data/Site/services/nova/api.json 
patching file Data/Site/services/rabbitmq.json</codeblock></li>
        </ol></section>
        <section><title>Apply the patch to the Node Configuration</title>
          <ol>
            
          <li>Change to the following directory:
          <codeblock>cd ~/kenobi-node-configuration</codeblock></li>
        <li>Execute the following command to perform a dry-run of the patch to verify:
            <codeblock>patch -p1 --dry-run &lt; ~/patch_cghelion1.1/random-password-nc.patch </codeblock><p>The
            output appears similar to the
          following:</p><codeblock>checking file ansible-playbooks/roles/FND-RMQ/tasks/deploy.yml
checking file ansible-playbooks/roles/FND-RMQ/tasks/updateusrpass.yml</codeblock></li>
        <li>Execute the following command to apply the patch:
            <codeblock>patch -p1 &lt; ~/patch_cghelion1.1/random-password-nc.patch</codeblock><p>The
            output appears similar to the
          following:</p><codeblock>patching file ansible-playbooks/roles/FND-RMQ/tasks/deploy.yml
patching file ansible-playbooks/roles/FND-RMQ/tasks/updateusrpass.yml </codeblock></li>
          </ol></section>
  <section><title>Synchronize the Patch Files to the Environment</title>
    <ol>
        <li>Change to the <codeph>~/cg-hlm/hlm-build</codeph>
          folder:<codeblock>cd ~/cg-hlm/hlm-build</codeblock></li>
        <li>Execute the following command to synch the patch
          file:<codeblock>./hlm_prepare-env.sh</codeblock></li>
      </ol>
    </section>
  <p>Return to the <xref href="carrier-grade-install-kvm.dita#topic10581cgik/patches">KVM
      installation</xref>.</p>
  <p>Return to <xref href="carrier-grade-install-kvm-esx-GA.dita#topic10581cgikeg/patches">the KVM + ESX
        installation</xref>.</p>
  </body>
</topic>
