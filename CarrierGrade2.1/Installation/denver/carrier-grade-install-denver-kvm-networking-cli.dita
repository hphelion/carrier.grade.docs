<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581cgidppncli">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.1: Step 5A- Configuring the
    Provider Networks</title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carrier Grade 2.0"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carrier Grade 2.0"/>
    </metadata>
  </prolog>
  <body>
    <p>After the HP Helion OpenStack Carrier Grade cloud is fully deployed, perform the following
      tasks in the Horizon UI.</p>
    <section>
      <title>Create the Provider Network</title>
      <p>Use the following steps to create a provider network and add a segmentation range. </p>
      <ol id="ol_a3x_lqf_2v">
        <li>SSH into the KVM region controller. For information, see <xref
            href="../../carrier-grade-access.dita#topic10581cgilhd/controller"/>.</li>
        <li>Execute the following command to create the network:
          <codeblock>neutron providernet-create &lt;name> \ --type=&lt;type> --description=&lt;description> mtu &lt;mtu_size> \ --vlan-transparent={True,False}</codeblock>Where:
            <ul id="ul_cjg_nqf_2v">
            <li><codeph>name</codeph> is a name for the provider network </li>
            <li><codeph>type</codeph> is the type of provider network (flat, vlan, or vxlan)</li>
            <li><codeph>description</codeph> is a brief description for reference purposes </li>
            <li><codeph>mtu_size</codeph> is the maximum transmission unit size</li>
          </ul></li>
        <li>Execute the following command to add a segmentation
              range:<codeblock>neutron providernet-range-create &lt;provider_network> \ --name=&lt;range_name> --tenant_id=&lt;tenant> \ --description=&lt;description> --range &lt;min-max> \ --group multicast_address --port=&lt;udp_port> \ --ttl=&lt;time_to_live> </codeblock><p>Where:<ul
              id="ul_n5r_crf_2v">
              <li><codeph>provider_network</codeph> is the name of the associated provider network </li>
              <li><codeph>name</codeph> is a name for the segmentation range </li>
              <li><codeph>tenant</codeph> is the name or UUID of the project (tenant) associated
                with the range </li>
              <li><codeph>description</codeph> is a brief description for reference purposes </li>
              <li><codeph>min</codeph> is the lowest value in the range </li>
              <li><codeph>max</codeph> is the highest value in the range </li>
              <li><codeph>vlan-transparent</codeph> Allow VLAN tagged packets to be encapsulated
                within a VXLAN segment without removing or modifying the guest VLAN tag.</li>
              <li><codeph>multicast_address</codeph> is the IPv4 or IPv6 address for participation
                in a multicast group used to discover MAC addresses for destination VMs. You can use
                a different multicast group for each segmentation range to help organize and
                partition network traffic. <b>VxLAN only.</b></li>
              <li><codeph>udp_port</codeph> is the destination UDP port for packets sent on the
                VXLAN. You can select either the IANA standard 4789 to use this range with the
                OpenStack Neutron service, or the legacy standard 8472 for use with some commercial
                switch equipment.  <b>VxLAN only.</b></li>
              <li><codeph>time_to_live</codeph> is the time-to-live, measured in hops, for packets
                sent on the VXLAN. The value is decremented at each hop; when it reaches zero, the
                packet expires. You can use this to limit the scope of the VXLAN. For example, to
                limit the packet to no more than three router hops, use a time-to-live value of 4.
                  <b>VxLAN only.</b></li>
            </ul></p></li>
      </ol>
    </section>
    <section>
      <title>PXE boot all the registered nodes</title>
      <p>Login to Horizon and monitor the status of nodes being PXE booted on the <b>Admin</b> then
          <b>Inventory</b> page. After succesful PXE boot, the Operational State should be
          <b>Disabled</b> and the Availability State should be <b>Online</b>. </p>
    </section>
    <section id="unlock">
      <title>Create the management and data networks</title>
      <p>After the controller-1 and the compute nodes come up successfully after PXE boot, execute
        the following commands from controller-0 to unlock each compute node in the inventory.</p>
      <ul id="ul_f1c_dk1_h5">
        <li><xref href="#topic1107cgikd/kvm-esx-unlock" format="dita">For a Non-Bonded
            Environment</xref></li>
        <li><xref href="#topic1107cgikd/nic-unlock" format="dita">For a Bonded
          Environment</xref></li>
      </ul>
      <p id="kvm-esx-unlock">
        <b>For a Non-Bonded Environment</b></p>
      <ol id="ol_w1g_3gz_dv">
        <li>After the controller-1 and the compute nodes come up successfully after PXE boot,
          execute the following commands from controller-0 to add the required interfaces.<ol
            id="ol_p42_d35_lt">
            <li>Obtain the compute name or ID number:<codeblock>system host-list</codeblock></li>
            <li>Obtain the UUID of the MGMT interface to
              remove:<codeblock>system host-if-list</codeblock></li>
            <li>Add the infrastructure network interface:
                <codeblock>system host-if-add -V &lt;VLAN_ID> -nt infra compute-1 infra vlan pxeboot0</codeblock><p>For
                example:<codeblock>system host-if-add -V 539 -nt infra compute-1 infra vlan pxeboot0</codeblock></p><p>This
                command configures the <codeph>pxeboot0</codeph> interface on compute-1 to connect
                to the infrastructure network using VLAN ID 539. </p></li>
            <li>Configure the compute nodes: <p>
                <codeblock>system host-if-modify -nt data compute-1 "provider-net-1" &lt;port></codeblock>
              </p><p>For
                example:<codeblock>system host-if-modify -nt data compute-1 "provider-net-1" eth3</codeblock></p><p>This
                command configures the data interface on <codeph>compute-1</codeph> to connect with
                  <codeph>provider-net-1</codeph> using <codeph>eth3</codeph>.</p></li>
          </ol></li>
      </ol>
      <p id="nic-unlock">
        <b>For bonded NIC environments</b></p>
      <p>If you are using a bonded NIC environment, after configuring and unlocking the compute
        nodes, perform these steps:</p>
      <ol id="ol_nr5_ddw_mt">
        <li>After the controller-1 and the compute nodes come up successfully after PXE boot,
          execute the following commands from controller-0 to add the required interface:<ol
            id="ol_zfq_5h1_tt">
            <li>Obtain the compute name or ID number:<codeblock>system host-list</codeblock></li>
            <li>Obtain the UUID of the MGMT
              interface:<codeblock>system host-if-list</codeblock></li>
            <li>Remove the PXE boot flag off the
              interface:<codeblock>system host-if-modify -nt "none" compute-1 pxeboot0</codeblock></li>
          </ol></li>
        <li>Execute the following commands to create a bonded interface and setup node to be
            unlocked:<ol id="ol_xyc_fww_dv">
            <li>Create a bonded interface for the control plane:
              <codeblock>system host-if-add -a 802.3ad -x layer2 -nt pxeboot compute-1 bond0 ae none eth0 eth1</codeblock></li>
            <li>Create a bonded interface for infra and management
              interface:<codeblock>system host-if-add -V 532 -nt mgmt compute-1 mgmt vlan bond0
system host-if-add -V 539 -nt infra compute-1 infra vlan bond0</codeblock></li>
            <li>Create a bonded interface for the data plane:
              <codeblock>system host-if-add -a balanced -x layer2 -nt data compute-1 databond ae "provider-net-1" eth2 eth3 </codeblock></li>
          </ol></li>
      </ol>
    </section>
    <section>
      <title>Unlock the compute node</title>
    </section>
    <ol>
      <li>Execute the following command on the controller to unlock the stand-by compute
        controller:<codeblock>system host-unlock compute-1</codeblock></li>
    </ol>
  </body>
</topic>
