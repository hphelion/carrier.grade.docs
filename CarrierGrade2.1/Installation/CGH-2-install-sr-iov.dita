<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581c2isi">
    <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.1:
        Configuring SR-IOV</title>
    <prolog>
        <metadata>
            <othermeta name="layout" content="default"/>
            <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 1.1"/>
            <othermeta name="role" content="Storage Administrator"/>
            <othermeta name="role" content="Storage Architect"/>
            <othermeta name="role" content="Michael B"/>
            <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 1.1"/>
        </metadata>
    </prolog>
    <body>
        <p>An <xref href="CGH-2-install-sriov-pci.dita#topic10581c2isio/sriov">SR-IOV Ethernet
                interface</xref> is a physical PCI Ethernet NIC that implements hardware-based
            virtualization mechanisms to expose multiple virtual network interfaces that can be used
            by one or more virtual machines simultaneously.</p>
        <p>With SR-IOV based NICs, the traditional virtual bridge is no longer required. Each SR-IOV
            port is associated with a virtual function (VF).</p>
        <p>The process for configuring SR-IOV includes creating a VLAN provider network and subnet,
            then attaching VMs to that network.</p>
        <p>In the following example a new virtual machine is launched by user user1 on tenant
            tenant1, with a VF interface connected to the tenant network tenant1-net1 identified
            with VLAN ID 20. Note: To use PCI passthrough or SR-IOV interfaces, you must have Intel
            VT-d features enabled in the BIOS. The exercise assumes that the underlying provider
            network group0-data0 exists already, and that VLAN ID 20 is a valid segmentation ID
            assigned to tenant1. 1. Log in as the admin user to the web management interface. 2.
            Lock the compute node you want to configure. 3. Configure the Ethernet interface to be
            used as a SR-IOV interface. Select the System Inventory window from the Admin panel,
            click the Hosts tab, click the name of the compute node where the PCI interface is
            available, click the Interfaces tab, and finally click the Edit Interface button
            associated with the interface you want to configure. Fill in the window as illustrated
            below: HP Helion OpenStack Carrier Grade | Configuration Planning | 33 In this example,
            Ethernet interface eth8 is assigned the network type pci-sriov, enabled to use 4 VFs,
            and configured as connected to provider network group0-data0. Click the Save button to
            proceed. The Maximum number of VFs displayed in this form is a read-only item which is
            auto-discovered by the system by inspecting the specific NIC model. This value is
            reported as 0 when the selected interface does not support SRIOV. The interface can also
            be configured from the CLI as illustrated below: ~(keystone_admin)$ system
            host-if-modify \ -nt pci-sriov -N 4 -p group0-data0 compute-0 eth8 Note: By default, a
            VM that requires an SR-IOV interface is instantiated only if a host NUMA node with a
            directly attached PCI interface is available. You can specify best-effort instantiation
            by using an extra specification. For more information, see Specifying Best Effort for
            PCI NUMA Node Affinity on page 151. 4. Create the tenant1-net1 tenant network. You must
            ensure that: • The tenant1 tenant has access to the tenant network, either assigning it
            as the owner, or by enabling the tenant network's shared flag. • The segmentation ID is
            set to 20. HP Helion OpenStack Carrier Grade | Configuration Planning | 34 5. Configure
            the access switch. Configure the physical port on the access switch used to connect to
            Ethernet interface eth8 as an access port with default VLAN ID of 20. 6. Unlock the
            compute node. 7. Launch the virtual machine. a) Log in as user user1 to the web
            management interface. b) Configure the network interfaces for the new virtual machine.
            Open the Launch Instance dialog by clicking the Launch Interface button on the Instances
            window. Configure the necessary options for the new virtual machine. In particular,
            click the Networking tab and add a SR-IOV interface on the tenant network tenant1-net1,
            as illustrated below. Add other network interfaces as needed, there are as many SR-IOV
            ports available as VFs have been enabled. Click the Launch button to proceed. SR-IOV
            interfaces can be attached from the CLI when booting a new virtual machine, as
            illustrated below: ~(keystone_admin)$ nova boot \ --nic
            net-id=704e9f3b,vif-model=pci-sriov --flavor small \ --image cgcs-guest my-new-vm The
            new virtual machine instance is up now. It has a SR-IOV VF connection to the
            tenant1-net1 tenant network identified with VLAN ID 20. Access switches must be properly
            configured to ensure that virtual machines using PCI-passthrough or SRIOV Ethernet
            interfaces (the latter discussed in SR-IOV Ethernet Interfaces on page 32) have the
            expected connectivity. In a common scenario, the virtual machine using these interfaces
            connects to external end points only, that is, it does not connect to other virtual
            machines in the same cluster. In this case: • Traffic between the virtual machine and
            the access switch can be tagged or untagged. • The connecting port on the access switch
            is part of a port-based VLAN. • If the port is tagged, the allowed VLAN ID range must
            not overlap with VLAN ID ranges used by the AVS ports. • The port-based VLAN provides
            the required connectivity to external switching and routing equipment needed by guest
            applications to establish connections to the intended end points. For connectivity to
            other virtual machines in the cluster the following configuration is also required: HP
            Helion OpenStack Carrier Grade | Configuration Planning | 35 • The VLAN ID used for the
            tenant network, 10 in this example, and the default port VLAN ID of the access port on
            the switch are the same. This ensures that incoming traffic from the virtual machine is
            tagged internally by the switch as belonging to VLAN ID 10, and switched to the
            appropriate exit ports. • The target virtual machines are reachable through another port
            on the compute node, which is managed by the AVS. • That other port is configured as
            usual, as a VLAN trunk port, and the tenant network's VLAN ID (10) is included in the
            tagged range. This ensures that VLAN 10 is common to both the passthrough/SR-IOV
            interface and the AVS port.</p>
        <p><b>Related links</b></p>
        <p>For more information, see <xref
                href="https://wiki.openstack.org/wiki/SR-IOV-Passthrough-For-Networking"
                format="html" scope="external">SR-IOV Passthrough for Networking</xref> in the
            OpenStack wiki.</p>
    </body>

</topic>
