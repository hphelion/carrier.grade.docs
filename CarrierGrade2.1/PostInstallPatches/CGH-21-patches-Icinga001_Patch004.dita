<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581pdpkvm215">
  <title>HP Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.1: Deploy the Cumulative Icinga
    Patch 004 </title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HP Helion OpenStack Carreir Grade 1.1"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HP Helion OpenStack Carreir Grade 1.1"/>
    </metadata>
  </prolog>
  <body>
      <section id="fixes">
        <p>This patch is applicable for Denver, Tahoe, Memphis and Sacramento cloud topologies. It
          addresses the following issues:<ul id="ul_jxm_nkt_jv">
            <li>Will set up NRPE checks for basic services like disk,load, processes and users from
              all standard region nodes and reports in Icinga web.</li>
            <li> Openstack services of HOS controller nodes are monitored and reported in Icinga
              web.</li>
            <li> Icinga alerting and notification of all agents are reported in Icinga web.</li>
          </ul></p>
      </section>
      <section>
        <p>
          <note>
            <b>This is an optional patch and can be installed on need basis based on the below
              feature support.</b></note>
        </p>
      </section>
      <section>
        <title>Prerequisites</title>
        <ol id="ol_qrx_cnz_lw">
          <li>HCG cloud has already been deployed.</li>
          <li> HCG 2.1 GA (Build 50). </li>
        </ol>
      </section>
      <section conref="CGH-21-post-install-patching.dita#topic10581pdp21/launch"/>
      <section>
        <title>Downloading the Icinga Patch</title>
        <p>Download the <b
          conref="../Installation/denver/carrier-grade-install-download-denver.dita#topic7148cgidd/4"
        /> file and the associated checksum and signature files. Verify the <xref
          href="../Installation/prereqs/carrier-grade-install-download.dita#topic7148cgid/verify"
          >downloaded signature</xref> and the <xref
          href="../Installation/prereqs/carrier-grade-install-download.dita#topic7148cgid/checksum"
          >downloaded checksums</xref>. Extract the compressed files until the
          <codeph>HCG-Cumulative-Icinga-Patch</codeph> and <codeph>Readme-post-deploy.txt</codeph>
        files are available.</p>
        <p/>
      </section>
      <section>
        <title>Apply the patch</title>
        <ol id="ol_qbh_tpm_s5">
          <li>Log onto the lifecycle manager VM.
              <codeblock>ssh &lt;lifecycle manager_VM_IP></codeblock><p>where: lifecycle
              manager_VM_IP is the CLM IP of the lifecycle manager. Locate the IP address for the
              lifecycle manager in the <codeph>/root/infra-ansible-playbooks/group_vars/all</codeph>
              file under <codeph>hlm_clmstaticip</codeph> field.</p></li>
          <li>Copy the below mentioned patches on to hlm node under /root/ folder: <ul
              id="ul_n4c_wg1_mw">
              <li>0001-Cumulative-config-processor-icinga-patch-for-GA-2.1.patch </li>
              <li>0001-Cumulative-node-configuration-icinga-patch-for-GA2.1.patch</li>
            </ul></li>
          <li>Update the json files with "NRP-SVC" role in
            directory:<codeblock>/var/hlm/clouds/&lt;cloudname>/.hos/ [This directory contains the ansible roles for the applicable nodes across different topologies]</codeblock><codeblock>/var/hlm/clouds/&lt;cloud name>/.hos

File name: 
   ccp-1x3-ss.json

   Example:
                {
                    "name": "IC2-WEB"
                },
                {
                    "name": "NRP-SVC"  #"NRP-SVC" role is added
                },
                {
                    "name": "rcp-libvirtmon-opensaf"
                },
                {
                    "name": "Finalize"
                }</codeblock></li>
          <li> Execute the following command from the hlm node:
            <codeblock> cd /root/kenobi-configuration-processor &amp;&amp; patch -p1 -b &lt; /root/0001-Cumulative-config-processor-icinga-patch-for-GA-2.1.patch
</codeblock></li>
          <li>Execute the following command from the hlm node:
            <codeblock>cd /root/kenobi-node-configuration &amp;&amp; patch -p1 -b &lt; /root/0001-Cumulative-node-configuration-icinga-patch-for-GA2.1.patch</codeblock></li>
          <li>Run <codeph>hlm_prepare-env.sh
            </codeph><codeblock>      cd ~/cg-hlm/hlm-build

     ./hlm_prepare-env.sh</codeblock></li>
          <li>Run <codeph>hlm
            generate</codeph><codeblock>hlm generate -c &lt;cloud name></codeblock></li>
          <li>Run only icinga roles:
              <codeblock>hlm deploy -c &lt;cloud name> -t "IC2-SVC IC2-WEB NRP-SVC" </codeblock><p>Where
              &lt;cloud name> is the name of your cloud.</p></li>
        </ol>
      </section>
      <section>
        <title>Next Step</title>
        <p><xref href="CGH-21-post-install-patching.dita#topic10581pdp/kvm">Return to
            Post-Installation Patches</xref></p>
      </section>
  </body>
</topic>
